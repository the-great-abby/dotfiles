#!/bin/bash
# GTD Area Starter - Create important starter areas of responsibility

# Source common environment (PATH setup)
COMMON_ENV="$HOME/code/dotfiles/zsh/common_env.sh"
if [[ ! -f "$COMMON_ENV" && -f "$HOME/code/personal/dotfiles/zsh/common_env.sh" ]]; then
  COMMON_ENV="$HOME/code/personal/dotfiles/zsh/common_env.sh"
fi
if [[ -f "$COMMON_ENV" ]]; then
  source "$COMMON_ENV"
fi


# Load GTD config
GTD_CONFIG_FILE="$HOME/.gtd_config"
if [[ -f "$HOME/code/dotfiles/zsh/.gtd_config" ]]; then
  GTD_CONFIG_FILE="$HOME/code/dotfiles/zsh/.gtd_config"
elif [[ -f "$HOME/code/personal/dotfiles/zsh/.gtd_config" ]]; then
  GTD_CONFIG_FILE="$HOME/code/personal/dotfiles/zsh/.gtd_config"
fi

if [[ -f "$GTD_CONFIG_FILE" ]]; then
  source "$GTD_CONFIG_FILE"
fi

# Colors
CYAN='\033[0;36m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BOLD='\033[1m'
NC='\033[0m'

# Starter areas with descriptions
# Helper functions for associative array simulation (bash 3.2 compatible)
_set_array_value() {
  local prefix="$1"
  local key="$2"
  local value="$3"
  eval "${prefix}_${key}=\"\$value\""
}

_get_array_value() {
  local prefix="$1"
  local key="$2"
  eval "echo \"\$${prefix}_${key}\""
}

# Initialize STARTER_AREAS (simulated associative array)
_set_array_value "STARTER_AREAS" "Health & Wellness" "Physical and mental health - workouts, nutrition, medication, sleep"
_set_array_value "STARTER_AREAS" "Finances" "Budgeting, bills, savings, investments, financial planning"
_set_array_value "STARTER_AREAS" "Home & Living Space" "Cleaning, maintenance, organization, repairs, chores"
_set_array_value "STARTER_AREAS" "Relationships" "Family, friends, romantic relationships, social connections"
_set_array_value "STARTER_AREAS" "Personal Development" "Learning, skills, education, hobbies, growth"
_set_array_value "STARTER_AREAS" "Work & Career" "Job performance, skill development, networking, career planning"
_set_array_value "STARTER_AREAS" "Administrative" "Documents, insurance, legal, subscriptions, records"
_set_array_value "STARTER_AREAS" "Self-Care & Wellbeing" "Stress management, relaxation, boundaries, emotional wellbeing"
_set_array_value "STARTER_AREAS" "Community & Giving" "Volunteering, charitable giving, helping others, social causes"
_set_array_value "STARTER_AREAS" "Systems & Organization" "GTD system, Second Brain, workflows, reviews"

# Maintain array of keys for iteration
STARTER_AREAS_KEYS=("Health & Wellness" "Finances" "Home & Living Space" "Relationships" "Personal Development" "Work & Career" "Administrative" "Self-Care & Wellbeing" "Community & Giving" "Systems & Organization")

# Show starter areas menu
show_starter_menu() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ¯ Starter Areas of Responsibility${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "Create important areas of responsibility to get started with GTD."
  echo ""
  echo "Recommended Starter Areas:"
  echo ""
  
  local i=1
  for area_name in "${STARTER_AREAS_KEYS[@]}"; do
    local description="$(_get_array_value "STARTER_AREAS" "$area_name")"
    echo -e "${GREEN}$i)${NC} ${BOLD}$area_name${NC}"
    echo "   $description"
    echo ""
    ((i++))
  done
  
  echo -e "${GREEN}11)${NC} Create all recommended areas"
  echo -e "${GREEN}12)${NC} Create top 5 essential areas"
  echo ""
  echo -e "${YELLOW}0)${NC} Back"
  echo ""
  echo -n "Choose: "
}

# Create a single area
create_area() {
  local area_name="$1"
  
  if [[ -z "$area_name" ]]; then
    echo "âŒ Area name required"
    return 1
  fi
  
  echo ""
  echo "Creating area: $area_name"
  gtd-area create "$area_name"
  
  if [[ $? -eq 0 ]]; then
    echo "âœ“ Created: $area_name"
    echo ""
    echo "ğŸ’¡ Next steps:"
    echo "  â€¢ Define standards: What does 'maintained' look like?"
    echo "  â€¢ Review: gtd-area view \"$area_name\""
    echo "  â€¢ Link to daily logs: Track activities in this area"
    echo ""
  fi
}

# Create top 5 essential areas
create_top_5() {
  echo ""
  echo -e "${BOLD}${CYAN}Creating Top 5 Essential Areas${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  
  local top_5=(
    "Health & Wellness"
    "Finances"
    "Home & Living Space"
    "Personal Development"
    "Relationships"
  )
  
  for area_name in "${top_5[@]}"; do
    create_area "$area_name"
  done
  
  echo ""
  echo "âœ“ Top 5 essential areas created!"
  echo ""
  echo "ğŸ“š Learn more: ~/code/dotfiles/zsh/STARTER_AREAS_GUIDE.md"
  echo ""
}

# Create all recommended areas
create_all() {
  echo ""
  echo -e "${BOLD}${CYAN}Creating All Recommended Areas${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  
  for area_name in "${!STARTER_AREAS[@]}"; do
    create_area "$area_name"
  done
  
  echo ""
  echo "âœ“ All recommended areas created!"
  echo ""
  echo "ğŸ“š Learn more: ~/code/dotfiles/zsh/STARTER_AREAS_GUIDE.md"
  echo ""
}

# Main function
main() {
  while true; do
    show_starter_menu
    read choice
    
    case "$choice" in
      1)
        create_area "Health & Wellness"
        echo "Press Enter to continue..."
        read
        ;;
      2)
        create_area "Finances"
        echo "Press Enter to continue..."
        read
        ;;
      3)
        create_area "Home & Living Space"
        echo "Press Enter to continue..."
        read
        ;;
      4)
        create_area "Relationships"
        echo "Press Enter to continue..."
        read
        ;;
      5)
        create_area "Personal Development"
        echo "Press Enter to continue..."
        read
        ;;
      6)
        create_area "Work & Career"
        echo "Press Enter to continue..."
        read
        ;;
      7)
        create_area "Administrative"
        echo "Press Enter to continue..."
        read
        ;;
      8)
        create_area "Self-Care & Wellbeing"
        echo "Press Enter to continue..."
        read
        ;;
      9)
        create_area "Community & Giving"
        echo "Press Enter to continue..."
        read
        ;;
      10)
        create_area "Systems & Organization"
        echo "Press Enter to continue..."
        read
        ;;
      11)
        create_all
        echo "Press Enter to continue..."
        read
        ;;
      12)
        create_top_5
        echo "Press Enter to continue..."
        read
        ;;
      0)
        exit 0
        ;;
      *)
        echo "Invalid choice"
        sleep 1
        ;;
    esac
  done
}

# Show usage
show_usage() {
  cat <<EOF
Usage: gtd-area-starter

Interactive menu to create important starter areas of responsibility.

This command helps you create the most important areas of responsibility
to get started with your GTD system.

Recommended starter areas:
  1. Health & Wellness
  2. Finances
  3. Home & Living Space
  4. Personal Development
  5. Relationships

See also: ~/code/dotfiles/zsh/STARTER_AREAS_GUIDE.md

EOF
}

# Handle arguments
case "${1:-}" in
  --help|-h)
    show_usage
    exit 0
    ;;
  "")
    main
    ;;
  *)
    echo "Unknown option: $1"
    show_usage
    exit 1
    ;;
esac

