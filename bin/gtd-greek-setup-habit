#!/bin/bash
# Create Greek Study habit in GTD habit system

# Load GTD config
GTD_CONFIG_FILE="$HOME/.gtd_config"
if [[ -f "$HOME/code/dotfiles/zsh/.gtd_config" ]]; then
  GTD_CONFIG_FILE="$HOME/code/dotfiles/zsh/.gtd_config"
elif [[ -f "$HOME/code/personal/dotfiles/zsh/.gtd_config" ]]; then
  GTD_CONFIG_FILE="$HOME/code/personal/dotfiles/zsh/.gtd_config"
fi

if [[ -f "$GTD_CONFIG_FILE" ]]; then
  source "$GTD_CONFIG_FILE"
fi

GTD_BASE_DIR="${GTD_BASE_DIR:-$HOME/Documents/gtd}"
HABITS_PATH="${GTD_BASE_DIR}/habits"

# Colors
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BOLD='\033[1m'
NC='\033[0m'

# Check if habit exists
habit_slug="greek-study"
habit_file="${HABITS_PATH}/${habit_slug}.md"

if [[ -f "$habit_file" ]]; then
  echo "✓ Greek Study habit already exists!"
  echo ""
  echo "Location: $habit_file"
  echo ""
  echo "Track your study with:"
  echo "  gtd-habit log 'Greek Study'"
  echo ""
  echo "Or it will be logged automatically when you:"
  echo "  • Complete lessons (gtd-learn-greek)"
  echo "  • Study Greek language"
  exit 0
fi

# Create habit
echo "Creating Greek Study habit..."
echo ""

if command -v gtd-habit &>/dev/null; then
  # Use gtd-habit to create it
  echo "Greek Study" | gtd-habit create
  
  # Set description and area
  if [[ -f "$habit_file" ]]; then
    # Update description
    if [[ "$OSTYPE" == "darwin"* ]]; then
      sed -i '' '/^## Description$/a\
Study Greek language - learning to read and understand Greek (any activity counts)
' "$habit_file"
    else
      sed -i '/^## Description$/a\Study Greek language - learning to read and understand Greek (any activity counts)' "$habit_file"
    fi
    
    # Set area to Learning/Personal Development
    if [[ "$OSTYPE" == "darwin"* ]]; then
      sed -i '' 's/^area:.*/area: Learning/' "$habit_file"
    else
      sed -i 's/^area:.*/area: Learning/' "$habit_file"
    fi
  fi
  
  echo ""
  echo -e "${GREEN}✓${NC} Greek Study habit created!"
  echo ""
  echo "This habit will be automatically logged when you:"
  echo "  • Complete lessons (gtd-learn-greek)"
  echo "  • Study Greek language"
  echo ""
  echo "You can also log it manually:"
  echo "  gtd-habit log 'Greek Study'"
  echo ""
else
  echo "❌ gtd-habit command not found"
  echo ""
  echo "Please install the habit system first, or create the habit manually:"
  echo "  gtd-habit create 'Greek Study'"
  exit 1
fi

