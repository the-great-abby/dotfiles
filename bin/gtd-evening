#!/bin/bash
# Evening routine - Wrap up your day

# Colors
CYAN='\033[0;36m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BOLD='\033[1m'
NC='\033[0m'

echo ""
echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${BOLD}${CYAN}ðŸŒ™ Evening Wrap-Up${NC}"
echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo ""

# 1. Process inbox
inbox_count=$(ls -1 ~/Documents/gtd/0-inbox/*.md 2>/dev/null | wc -l | tr -d ' ')
if [[ $inbox_count -gt 0 ]]; then
  echo -e "${YELLOW}ðŸ“¥ Inbox: ${inbox_count} item(s)${NC}"
  read -p "Process inbox? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    gtd-process
  fi
fi

# 2. Daily log
echo ""
read -p "Evening log entry: " log_entry
if [[ -n "$log_entry" ]]; then
  # Use gtd-daily-log script (standalone version of addInfoToDailyLog)
  # This works in bash scripts, unlike the zsh function
  if command -v gtd-daily-log &>/dev/null; then
    gtd-daily-log "$log_entry"
  elif [[ -f "$HOME/code/dotfiles/bin/gtd-daily-log" ]]; then
    "$HOME/code/dotfiles/bin/gtd-daily-log" "$log_entry"
  elif [[ -f "$HOME/code/personal/dotfiles/bin/gtd-daily-log" ]]; then
    "$HOME/code/personal/dotfiles/bin/gtd-daily-log" "$log_entry"
  else
    echo "âš ï¸  Daily log command not found. Using fallback..."
    # Fallback: implement basic logging directly
    log_dir="${DAILY_LOG_DIR:-$HOME/Documents/daily_logs}"
    today=$(date +"%Y-%m-%d")
    current_time=$(date +"%H:%M")
    log_file="${log_dir}/${today}.txt"
    mkdir -p "$log_dir"
    if [[ ! -f "$log_file" ]]; then
      echo "# Daily Log - $today" > "$log_file"
      echo "" >> "$log_file"
    fi
    echo "${current_time} - ${log_entry}" >> "$log_file"
    echo "âœ“ Added: ${current_time} - ${log_entry}"
  fi
fi

# 3. Quick review
echo ""
read -p "Quick daily review? (y/n) " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
  gtd-review daily
fi

echo ""
echo -e "${GREEN}âœ… Evening routine complete! Rest well.${NC}"
echo ""


