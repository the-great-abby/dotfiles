#!/bin/bash
# GTD Mood Logger - Log mood and energy to daily log
# Usage: gtd-log-mood [mood] [energy] [note]
# Or call without args for interactive mode

# Load config
DAILY_LOG_CONFIG="$HOME/.daily_log_config"
if [[ -f "$HOME/code/dotfiles/zsh/.daily_log_config" ]]; then
  DAILY_LOG_CONFIG="$HOME/code/dotfiles/zsh/.daily_log_config"
elif [[ -f "$HOME/code/personal/dotfiles/zsh/.daily_log_config" ]]; then
  DAILY_LOG_CONFIG="$HOME/code/personal/dotfiles/zsh/.daily_log_config"
fi

if [[ -f "$DAILY_LOG_CONFIG" ]]; then
  source "$DAILY_LOG_CONFIG"
fi

DAILY_LOG_DIR="${DAILY_LOG_DIR:-$HOME/Documents/daily_logs}"

# Get date command
get_date_cmd() {
  if [[ -x "/usr/bin/date" ]]; then
    echo "/usr/bin/date"
  elif [[ -x "/bin/date" ]]; then
    echo "/bin/date"
  else
    echo "date"
  fi
}

DATE_CMD=$(get_date_cmd)
today=$($DATE_CMD +"%Y-%m-%d")
current_time=$($DATE_CMD +"%H:%M")

# Parse arguments or prompt
if [[ -n "$1" && -n "$2" ]]; then
  mood="$1"
  energy="$2"
  note="${3:-}"
else
  # Interactive mode
  echo "ðŸ˜Š Mood & Energy Tracker"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  read -p "Mood (1-10): " mood
  read -p "Energy (high/medium/low): " energy
  read -p "Note (optional): " note
  echo ""
fi

# Validate mood
if ! [[ "$mood" =~ ^[0-9]+$ ]] || [[ "$mood" -lt 1 ]] || [[ "$mood" -gt 10 ]]; then
  echo "âŒ Mood must be a number between 1 and 10"
  exit 1
fi

# Validate energy
energy_lower=$(echo "$energy" | tr '[:upper:]' '[:lower:]')
if [[ "$energy_lower" != "high" && "$energy_lower" != "medium" && "$energy_lower" != "low" ]]; then
  echo "âŒ Energy must be: high, medium, or low"
  exit 1
fi

# Format entry
entry="Mood: ${mood}/10, Energy: ${energy_lower}"
if [[ -n "$note" ]]; then
  entry="${entry} - ${note}"
fi

# Use gtd-healthkit-log or gtd-daily-log
if command -v gtd-healthkit-log &>/dev/null; then
  gtd-healthkit-log "$entry" "$current_time"
elif command -v gtd-daily-log &>/dev/null; then
  gtd-daily-log "$entry"
elif [[ -f "$HOME/code/dotfiles/bin/gtd-daily-log" ]]; then
  "$HOME/code/dotfiles/bin/gtd-daily-log" "$entry"
else
  # Fallback
  log_file="${DAILY_LOG_DIR}/${today}.md"
  mkdir -p "$(dirname "$log_file")"
  if [[ ! -f "$log_file" ]]; then
    echo "# Daily Log - $today" > "$log_file"
    echo "" >> "$log_file"
  fi
  echo "${current_time} - ${entry}" >> "$log_file"
  echo "âœ“ Added: ${current_time} - ${entry}"
fi

exit 0

