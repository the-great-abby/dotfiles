#!/bin/bash
# Create study plan for any topic (Kubernetes, etc.) in GTD system

# Load GTD config
GTD_CONFIG_FILE="$HOME/.gtd_config"
if [[ -f "$HOME/code/dotfiles/zsh/.gtd_config" ]]; then
  GTD_CONFIG_FILE="$HOME/code/dotfiles/zsh/.gtd_config"
fi

if [[ -f "$GTD_CONFIG_FILE" ]]; then
  source "$GTD_CONFIG_FILE"
fi

GTD_BASE_DIR="${GTD_BASE_DIR:-$HOME/Documents/gtd}"
STUDY_DIR="${GTD_BASE_DIR}/study"

# Get date command
get_date_cmd() {
  if [[ -x "/usr/bin/date" ]]; then
    echo "/usr/bin/date"
  elif [[ -x "/bin/date" ]]; then
    echo "/bin/date"
  else
    echo "date"
  fi
}

DATE_CMD=$(get_date_cmd)

# Create CKA study plan
create_cka_plan() {
  local project_name="cka-exam-preparation"
  local project_dir="${GTD_BASE_DIR}/1-projects/${project_name}"
  
  mkdir -p "$project_dir"
  
  # Create project README
  cat > "${project_dir}/README.md" <<EOF
# CKA Exam Preparation

**Goal:** Pass the Certified Kubernetes Administrator (CKA) exam

**Target Date:** [Set your exam date]

**Status:** Active

## Exam Details
- **Duration:** 2 hours
- **Format:** Performance-based (hands-on)
- **Passing Score:** 66%
- **Topics:** 
  - Cluster Architecture, Installation & Configuration (25%)
  - Workloads & Scheduling (15%)
  - Services & Networking (20%)
  - Storage (10%)
  - Troubleshooting (30%)

## Study Plan

### Week 1-2: Fundamentals
- [ ] Kubernetes basics and architecture
- [ ] Pods, Deployments, Services
- [ ] ConfigMaps and Secrets
- [ ] Practice: Create and manage basic resources

### Week 3-4: Core Concepts
- [ ] Storage (PVs, PVCs, StorageClasses)
- [ ] Networking (Services, Ingress, Network Policies)
- [ ] Scheduling and Resource Management
- [ ] Practice: Multi-pod applications

### Week 5-6: Advanced Topics
- [ ] Cluster maintenance
- [ ] Security (RBAC, Pod Security)
- [ ] Monitoring and logging
- [ ] Practice: Troubleshooting scenarios

### Week 7-8: Exam Preparation
- [ ] Practice exams
- [ ] Time management practice
- [ ] Review weak areas
- [ ] Final preparation

## Daily Study Routine
1. Study for 1-2 hours daily
2. Practice with kubectl
3. Log progress: \`addInfoToDailyLog "K8s Study: [topic]"\`
4. Create tasks for practice exercises
5. Review weekly progress

## Resources
- Official Kubernetes Documentation
- CKA Exam Curriculum
- Practice environments (minikube, kind, k3s)
- Study notes in: \${STUDY_DIR}/kubernetes-cka/notes/

## Commands
- Learn: \`gtd-learn-kubernetes [topic]\`
- Track: \`addInfoToDailyLog "K8s Study: [topic]"\`
- Practice: Use kubectl commands daily
- Review: \`gtd-review weekly\`

Created: $($DATE_CMD)
EOF

  # Create initial tasks directly (non-interactive)
  echo "Creating initial study tasks..."
  
  local tasks_path="${GTD_BASE_DIR}/tasks"
  local today=$($DATE_CMD +"%Y-%m-%d")
  local now=$($DATE_CMD +"%H:%M")
  local timestamp=$(date +"%Y%m%d%H%M%S")
  
  mkdir -p "$tasks_path"
  
  # Task 1: Study Kubernetes basics
  local task1_file="${tasks_path}/${timestamp}-study-kubernetes-basics.md"
  cat > "$task1_file" <<EOF
---
type: task
status: active
created: ${today}T${now}
context: computer
energy: high
priority: not_urgent_important
project: ${project_name}
tags: []
---

# Study Kubernetes basics and architecture

## Next Action
Study Kubernetes basics and architecture

## Notes

EOF
  echo "✓ Created task: Study Kubernetes basics and architecture"
  
  # Task 2: Practice kubectl
  local task2_file="${tasks_path}/${timestamp}-practice-kubectl.md"
  cat > "$task2_file" <<EOF
---
type: task
status: active
created: ${today}T${now}
context: computer
energy: medium
priority: not_urgent_important
project: ${project_name}
tags: []
---

# Practice kubectl commands daily

## Next Action
Practice kubectl commands daily

## Notes

EOF
  echo "✓ Created task: Practice kubectl commands daily"
  
  # Task 3: Set up cluster
  local task3_file="${tasks_path}/${timestamp}-setup-kubernetes-cluster.md"
  cat > "$task3_file" <<EOF
---
type: task
status: active
created: ${today}T${now}
context: computer
energy: high
priority: not_urgent_important
project: ${project_name}
tags: []
---

# Set up local Kubernetes cluster (minikube/kind)

## Next Action
Set up local Kubernetes cluster (minikube/kind)

## Notes

EOF
  echo "✓ Created task: Set up local Kubernetes cluster"
  
  echo ""
  echo "✅ CKA Study Plan Created!"
  echo ""
  echo "Project: ${project_name}"
  echo "Location: ${project_dir}"
  echo ""
  echo "Next steps:"
  echo "  1. Review the plan: cat ${project_dir}/README.md"
  echo "  2. Set your exam date in the README"
  echo "  3. Start learning: gtd-learn-kubernetes"
  echo "  4. Track progress: addInfoToDailyLog \"K8s Study: [topic]\""
  echo ""
}

# Create Greek study plan
create_greek_plan() {
  local project_name="greek-language-learning"
  local project_dir="${GTD_BASE_DIR}/1-projects/${project_name}"
  
  mkdir -p "$project_dir"
  
  # Create project README
  cat > "${project_dir}/README.md" <<EOF
# Greek Language Learning

**Goal:** Learn to read and understand Greek (the language)

**Status:** Active

## Learning Objectives
- Learn the Greek alphabet (24 letters)
- Develop reading skills in Greek
- Build vocabulary
- Understand Greek grammar basics
- Develop reading comprehension

## Study Plan

### Phase 1: Alphabet & Basics (Weeks 1-2)
- [ ] Learn Greek alphabet (24 letters)
- [ ] Practice recognizing letters
- [ ] Learn basic pronunciation
- [ ] Practice writing Greek letters
- [ ] Start reading simple words

### Phase 2: Reading Fundamentals (Weeks 3-4)
- [ ] Build basic vocabulary
- [ ] Practice reading simple sentences
- [ ] Learn word recognition strategies
- [ ] Practice reading aloud
- [ ] Start understanding basic word structure

### Phase 3: Grammar & Comprehension (Weeks 5-8)
- [ ] Learn Greek grammar basics
- [ ] Understand noun cases
- [ ] Learn verb conjugations
- [ ] Practice reading comprehension
- [ ] Build more vocabulary
- [ ] Read simple texts

### Phase 4: Advanced Reading (Weeks 9-12)
- [ ] Read increasingly complex texts
- [ ] Expand vocabulary significantly
- [ ] Master grammar concepts
- [ ] Develop fluency in reading
- [ ] Understand nuanced meanings

## Daily Study Routine
1. Study for 30-60 minutes daily
2. Practice reading Greek text
3. Review vocabulary
4. Log progress: \`addInfoToDailyLog "Greek Study: [topic]"\`
5. Create tasks for practice exercises
6. Track habit: \`gtd-habit log "Greek Study"\`
7. Review weekly progress

## Resources
- Study notes in: \${STUDY_DIR}/greek/notes/
- Practice exercises in: \${STUDY_DIR}/greek/practice/
- Progress tracking in: \${STUDY_DIR}/greek/progress/

## Commands
- Learn: \`gtd-learn-greek [topic]\`
- Track: \`addInfoToDailyLog "Greek Study: [topic]"\`
- Habit: \`gtd-habit log "Greek Study"\`
- Study plan: \`gtd-study-plan greek\`
- Review: \`gtd-review weekly\`

## Topics Covered
1. Greek Alphabet (24 letters)
2. Reading Greek
3. Vocabulary Building
4. Grammar Basics
5. Verbs & Conjugation
6. Nouns & Cases
7. Reading Comprehension
8. Pronunciation

Created: $($DATE_CMD)
EOF

  # Create initial tasks directly (non-interactive)
  echo "Creating initial study tasks..."
  
  local tasks_path="${GTD_BASE_DIR}/tasks"
  local today=$($DATE_CMD +"%Y-%m-%d")
  local now=$($DATE_CMD +"%H:%M")
  local timestamp=$(date +"%Y%m%d%H%M%S")
  
  mkdir -p "$tasks_path"
  
  # Task 1: Learn Greek alphabet
  local task1_file="${tasks_path}/${timestamp}-learn-greek-alphabet.md"
  cat > "$task1_file" <<EOF
---
type: task
status: active
created: ${today}T${now}
context: computer
energy: medium
priority: not_urgent_important
project: ${project_name}
tags: []
---

# Learn Greek alphabet (24 letters)

## Next Action
Study the Greek alphabet and practice recognizing letters

## Notes

EOF
  echo "✓ Created task: Learn Greek alphabet (24 letters)"
  
  # Task 2: Practice reading
  local task2_file="${tasks_path}/${timestamp}-practice-reading-greek.md"
  cat > "$task2_file" <<EOF
---
type: task
status: active
created: ${today}T${now}
context: computer
energy: medium
priority: not_urgent_important
project: ${project_name}
tags: []
---

# Practice reading Greek daily

## Next Action
Practice reading Greek text daily

## Notes

EOF
  echo "✓ Created task: Practice reading Greek daily"
  
  # Task 3: Build vocabulary
  local task3_file="${tasks_path}/${timestamp}-build-greek-vocabulary.md"
  cat > "$task3_file" <<EOF
---
type: task
status: active
created: ${today}T${now}
context: computer
energy: low
priority: not_urgent_important
project: ${project_name}
tags: []
---

# Build Greek vocabulary

## Next Action
Learn new Greek words and practice vocabulary

## Notes

EOF
  echo "✓ Created task: Build Greek vocabulary"
  
  # Task 4: Setup habit
  local task4_file="${tasks_path}/${timestamp}-setup-greek-study-habit.md"
  cat > "$task4_file" <<EOF
---
type: task
status: active
created: ${today}T${now}
context: computer
energy: low
priority: not_urgent_important
project: ${project_name}
tags: []
---

# Setup Greek study habit

## Next Action
Run: gtd-greek-setup-habit to create habit tracking

## Notes

EOF
  echo "✓ Created task: Setup Greek study habit"
  
  echo ""
  echo "✅ Greek Language Learning Study Plan Created!"
  echo ""
  echo "Project: ${project_name}"
  echo "Location: ${project_dir}"
  echo ""
  echo "Next steps:"
  echo "  1. Review the plan: cat ${project_dir}/README.md"
  echo "  2. Setup habit: gtd-greek-setup-habit"
  echo "  3. Start learning: gtd-learn-greek"
  echo "  4. Track progress: addInfoToDailyLog \"Greek Study: [topic]\""
  echo ""
}

# Show usage
show_usage() {
  cat <<EOF
Usage: gtd-study-plan [topic]

Create a study plan integrated with your GTD system.

Topics:
  cka, kubernetes    - Create CKA exam preparation plan
  greek              - Create Greek language learning plan

Examples:
  gtd-study-plan cka
  gtd-study-plan greek

This will:
  • Create a GTD project for your study
  • Set up study structure
  • Create initial tasks
  • Integrate with your GTD system

EOF
}

# Main
case "$1" in
  cka|kubernetes|k8s)
    create_cka_plan
    ;;
  greek)
    create_greek_plan
    ;;
  --help|-h)
    show_usage
    exit 0
    ;;
  *)
    echo "Available study plans:"
    echo "  gtd-study-plan cka    - CKA exam preparation"
    echo "  gtd-study-plan greek  - Greek language learning"
    echo ""
    show_usage
    exit 1
    ;;
esac

