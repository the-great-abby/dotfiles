#!/bin/bash
# GTD Review Command - Daily and weekly reviews

# Source common environment (PATH setup)
COMMON_ENV="$HOME/code/dotfiles/zsh/common_env.sh"
if [[ ! -f "$COMMON_ENV" && -f "$HOME/code/personal/dotfiles/zsh/common_env.sh" ]]; then
  COMMON_ENV="$HOME/code/personal/dotfiles/zsh/common_env.sh"
fi
if [[ -f "$COMMON_ENV" ]]; then
  source "$COMMON_ENV"
fi

# Load GTD config
GTD_CONFIG_FILE="$HOME/.gtd_config"
if [[ -f "$HOME/code/personal/dotfiles/zsh/.gtd_config" ]]; then
  GTD_CONFIG_FILE="$HOME/code/personal/dotfiles/zsh/.gtd_config"
fi

# Source config if it exists
if [[ -f "$GTD_CONFIG_FILE" ]]; then
  source "$GTD_CONFIG_FILE"
fi

# Default values
GTD_BASE_DIR="${GTD_BASE_DIR:-$HOME/Documents/gtd}"
GTD_INBOX_DIR="${GTD_INBOX_DIR:-0-inbox}"
GTD_PROJECTS_DIR="${GTD_PROJECTS_DIR:-1-projects}"
GTD_AREAS_DIR="${GTD_AREAS_DIR:-2-areas}"
GTD_WAITING_DIR="${GTD_WAITING_DIR:-5-waiting-for}"
GTD_SOMEDAY_DIR="${GTD_SOMEDAY_DIR:-4-someday-maybe}"
GTD_WEEKLY_REVIEWS_DIR="${GTD_WEEKLY_REVIEWS_DIR:-weekly-reviews}"
SECOND_BRAIN="${SECOND_BRAIN:-$HOME/Documents/obsidian/Second Brain}"

INBOX_PATH="${GTD_BASE_DIR}/${GTD_INBOX_DIR}"
PROJECTS_PATH="${GTD_BASE_DIR}/${GTD_PROJECTS_DIR}"
AREAS_PATH="${GTD_BASE_DIR}/${GTD_AREAS_DIR}"
WAITING_PATH="${GTD_BASE_DIR}/${GTD_WAITING_DIR}"
SOMEDAY_PATH="${GTD_BASE_DIR}/${GTD_SOMEDAY_DIR}"
TASKS_PATH="${GTD_BASE_DIR}/tasks"
WEEKLY_REVIEWS_PATH="${GTD_BASE_DIR}/${GTD_WEEKLY_REVIEWS_DIR}"

mkdir -p "$WEEKLY_REVIEWS_PATH"

TODAY=$(date +"%Y-%m-%d")
NOW=$(date +"%H:%M")

# Count items
count_items() {
  local path="$1"
  find "$path" -type f -name "*.md" 2>/dev/null | wc -l | tr -d ' '
}

# Daily review
daily_review() {
  local review_type="${1:-auto}"  # auto, morning, or evening
  
  # Auto-detect time of day if not specified
  if [[ "$review_type" == "auto" ]]; then
    local current_hour=$(date +"%H" | sed 's/^0//')  # Remove leading zero
    if [[ $current_hour -lt 12 ]]; then
      review_type="morning"
    else
      review_type="evening"
    fi
  fi
  
  # Determine time of day label
  local time_label=""
  local time_icon=""
  if [[ "$review_type" == "morning" ]]; then
    time_label="Morning"
    time_icon="ðŸŒ…"
  else
    time_label="Evening"
    time_icon="ðŸŒ™"
  fi
  
  # Track review timing for preferences learning
  if command -v gtd-preferences-learn &>/dev/null; then
    gtd-preferences-learn track-review "daily" 2>/dev/null || true
  fi
  
  echo ""
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ“… Daily ${time_label} Review - $TODAY ${time_icon}"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  # Inbox count
  local inbox_count=$(count_items "$INBOX_PATH")
  echo "ðŸ“¥ Inbox: $inbox_count item(s)"
  if [[ $inbox_count -gt 0 ]]; then
    echo "   â†’ Run 'gtd-process' to process items"
  fi
  echo ""
  
  # Active tasks count
  local active_tasks=$(find "$TASKS_PATH" -type f -name "*.md" 2>/dev/null | while read f; do
    grep -q "^status: active" "$f" 2>/dev/null && echo "$f"
  done | wc -l | tr -d ' ')
  echo "ðŸ“‹ Active tasks: $active_tasks"
  echo ""
  
  # Daily review questions - different for morning vs evening
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ’­ Daily ${time_label} Review Questions"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  local priority1=""
  local priority2=""
  local priority3=""
  local accomplishments=""
  local blockers=""
  local attention_items=""
  local what_went_well=""
  local tomorrow_priorities=""
  
  if [[ "$review_type" == "morning" ]]; then
    # Morning review - plan for today
    echo "1. What are my top 3 priorities for today?"
    read -p "   Priority 1: " priority1
    read -p "   Priority 2: " priority2
    read -p "   Priority 3: " priority3
    echo ""
    
    echo "2. What did I accomplish yesterday?"
    read -p "   " accomplishments
    echo ""
    
    echo "3. What's blocking me?"
    read -p "   " blockers
    echo ""
    
    echo "4. What needs my attention?"
    read -p "   " attention_items
    echo ""
  else
    # Evening review - reflect on today, plan for tomorrow
    echo "1. What did I accomplish today?"
    read -p "   " accomplishments
    echo ""
    
    echo "2. What went well today?"
    read -p "   " what_went_well
    echo ""
    
    echo "3. What's blocking me?"
    read -p "   " blockers
    echo ""
    
    echo "4. What are my top 3 priorities for tomorrow?"
    read -p "   Priority 1: " priority1
    read -p "   Priority 2: " priority2
    read -p "   Priority 3: " priority3
    echo ""
    
    echo "5. What needs my attention?"
    read -p "   " attention_items
    echo ""
  fi
  
  # Save review
  local review_file="${WEEKLY_REVIEWS_PATH}/daily-${TODAY}-${review_type}.md"
  if [[ "$review_type" == "morning" ]]; then
    cat > "$review_file" <<EOF
---
type: daily_review
time: morning
date: ${TODAY}
created: ${TODAY}T${NOW}
---

# Daily Morning Review - ${TODAY} ðŸŒ…

## Priorities Today
1. ${priority1}
2. ${priority2}
3. ${priority3}

## Yesterday's Accomplishments
${accomplishments}

## Blockers
${blockers}

## Needs Attention
${attention_items}

## Stats
- Inbox items: ${inbox_count}
- Active tasks: ${active_tasks}

EOF
  else
    cat > "$review_file" <<EOF
---
type: daily_review
time: evening
date: ${TODAY}
created: ${TODAY}T${NOW}
---

# Daily Evening Review - ${TODAY} ðŸŒ™

## Today's Accomplishments
${accomplishments}

## What Went Well
${what_went_well}

## Priorities Tomorrow
1. ${priority1}
2. ${priority2}
3. ${priority3}

## Blockers
${blockers}

## Needs Attention
${attention_items}

## Stats
- Inbox items: ${inbox_count}
- Active tasks: ${active_tasks}

EOF
  fi
  
  echo "âœ“ Daily ${time_label} review saved: $review_file"
  echo ""
  
  # Offer AI advice
  read -p "Get AI advice on your ${review_type} review? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    local review_content=$(cat "$review_file")
    if command -v python3 &>/dev/null; then
      local persona_helper="$HOME/code/personal/dotfiles/zsh/functions/gtd_persona_helper.py"
      if [[ ! -f "$persona_helper" ]]; then
        persona_helper="$HOME/code/dotfiles/zsh/functions/gtd_persona_helper.py"
      fi
      if [[ -f "$persona_helper" ]]; then
        python3 "$persona_helper" "david" "$review_content" "daily_review"
      fi
    fi
  fi
}

# Weekly review
weekly_review() {
  # Track review timing for preferences learning
  if command -v gtd-preferences-learn &>/dev/null; then
    gtd-preferences-learn track-review "weekly" 2>/dev/null || true
  fi
  
  local week_start=$(date -v-monday +"%Y-%m-%d" 2>/dev/null || date -d "last monday" +"%Y-%m-%d" 2>/dev/null || date +"%Y-%m-%d")
  local week_end=$(date -v-sunday +"%Y-%m-%d" 2>/dev/null || date -d "next sunday" +"%Y-%m-%d" 2>/dev/null || date +"%Y-%m-%d")
  
  echo ""
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ“… Weekly Review - Week of $week_start to $week_end"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  # Process inbox first
  local inbox_count=$(count_items "$INBOX_PATH")
  if [[ $inbox_count -gt 0 ]]; then
    echo "ðŸ“¥ Inbox has $inbox_count item(s)"
    read -p "Process inbox now? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
      gtd-process --all
    fi
    echo ""
  fi
  
  # Projects
  local projects=($(find "$PROJECTS_PATH" -type d -mindepth 1 -maxdepth 1 2>/dev/null))
  local active_projects=0
  for project_dir in "${projects[@]}"; do
    local readme="${project_dir}/README.md"
    if [[ -f "$readme" ]]; then
      local status=$(grep "^status:" "$readme" 2>/dev/null | head -1 | cut -d':' -f2 | sed 's/^[[:space:]]*//')
      if [[ "$status" == "active" ]]; then
        ((active_projects++))
      fi
    fi
  done
  
  echo "ðŸ“ Active projects: $active_projects"
  echo ""
  
  # Detect stalled projects
  echo "ðŸ” Checking for stalled projects..."
  ENHANCED_SCRIPT="$HOME/code/dotfiles/bin/gtd-project-enhanced.sh"
  if [[ ! -f "$ENHANCED_SCRIPT" ]]; then
    ENHANCED_SCRIPT="$HOME/code/personal/dotfiles/bin/gtd-project-enhanced.sh"
  fi
  if [[ -f "$ENHANCED_SCRIPT" ]]; then
    source "$ENHANCED_SCRIPT"
    detect_stalled_projects | head -30
  fi
  echo ""
  
  # Waiting for
  local waiting_count=$(count_items "$WAITING_PATH")
  echo "â³ Waiting for: $waiting_count item(s)"
  if [[ $waiting_count -gt 0 ]]; then
    echo "   â†’ Review and follow up on waiting items"
  fi
  echo ""
  
  # Weekly review questions
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ’­ Weekly Review Questions"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  echo "1. What projects need attention?"
  read -p "   " projects_attention
  echo ""
  
  echo "2. What's in my inbox that needs processing?"
  read -p "   " inbox_items
  echo ""
  
  echo "3. What's on my calendar for next week?"
  read -p "   " calendar_next_week
  echo ""
  
  echo "4. What's in Waiting For that I should follow up on?"
  read -p "   " waiting_followups
  echo ""
  
  echo "5. What's in Someday/Maybe that I want to activate?"
  read -p "   " someday_activate
  echo ""
  
  echo "6. What areas of responsibility need attention?"
  read -p "   " areas_attention
  echo ""
  
  # Area Review Section
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸŽ¯ Area Review - Are Your Areas Still Relevant?"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  # List all areas
  local areas=($(find "$AREAS_PATH" -type f -name "*.md" 2>/dev/null))
  local area_count=${#areas[@]}
  
  if [[ $area_count -gt 0 ]]; then
    echo "You have ${area_count} area(s) of responsibility:"
    echo ""
    
    for area_file in "${areas[@]}"; do
      local area_name=$(basename "$area_file" .md | tr '-' ' ' | sed 's/\b\(.\)/\u\1/g')
      local last_review=$(grep "^## Review -" "$area_file" 2>/dev/null | tail -1 | sed 's/^## Review - //' || echo "Never")
      local status=$(grep "^status:" "$area_file" 2>/dev/null | head -1 | cut -d':' -f2 | sed 's/^[[:space:]]*//' || echo "active")
      
      echo "  â€¢ ${area_name} (status: ${status}, last reviewed: ${last_review})"
    done
    echo ""
    
    echo "For each area, consider:"
    echo "  - Is it still relevant to your life?"
    echo "  - Does it need regular attention?"
    echo "  - Should it be archived or merged?"
    echo ""
    
    read -p "Review areas now? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
      gtd-area review-all
    fi
    echo ""
  else
    echo "No areas defined yet."
    echo ""
    read -p "Would you like to create starter areas? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
      gtd-area-starter
    fi
    echo ""
  fi
  
  # Ask about new areas
  echo "7. Are there new areas of responsibility you need to add?"
  read -p "   " new_areas
  echo ""
  
  if [[ -n "$new_areas" && "$new_areas" != "none" && "$new_areas" != "no" ]]; then
    read -p "Create these areas now? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
      echo ""
      echo "You can create areas with:"
      echo "  gtd-area create \"Area Name\""
      echo "  gtd-area-starter  (for starter areas)"
      echo ""
    fi
  fi
  echo ""
  
  # Second Brain Review
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ§  Second Brain Review"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  # Count Second Brain notes
  local second_brain="${SECOND_BRAIN:-$HOME/Documents/obsidian/Second Brain}"
  local brain_notes=0
  local brain_projects=0
  local brain_resources=0
  
  if [[ -d "$second_brain" ]]; then
    brain_notes=$(find "$second_brain" -type f -name "*.md" ! -path "*/Templates/*" ! -path "*/MOCs/*" ! -path "*/.obsidian/*" ! -path "*/Express/*" 2>/dev/null | wc -l | tr -d ' ')
    brain_projects=$(find "$second_brain/Projects" -type f -name "*.md" 2>/dev/null | wc -l | tr -d ' ')
    brain_resources=$(find "$second_brain/Resources" -type f -name "*.md" 2>/dev/null | wc -l | tr -d ' ')
  fi
  
  echo "ðŸ“Š Second Brain Stats:"
  echo "   Total notes: ${brain_notes}"
  echo "   Project notes: ${brain_projects}"
  echo "   Resource notes: ${brain_resources}"
  echo ""
  
  echo "8. What Second Brain notes need refinement or summarization?"
  read -p "   " brain_refine
  echo ""
  
  echo "9. What notes should I review for connections?"
  read -p "   " brain_connections
  echo ""
  
  echo "10. What MOCs need updating?"
  read -p "   " brain_mocs
  echo ""
  
  echo "11. What content can I create from my notes? (Express phase)"
  read -p "   " brain_express
  echo ""
  
  # Save review
  local review_file="${WEEKLY_REVIEWS_PATH}/weekly-${TODAY}.md"
  cat > "$review_file" <<EOF
---
type: weekly_review
date: ${TODAY}
week_start: ${week_start}
week_end: ${week_end}
created: ${TODAY}T${NOW}
---

# Weekly Review - Week of ${week_start} to ${week_end}

## Projects Needing Attention
${projects_attention}

## Inbox Items
${inbox_items}

## Calendar - Next Week
${calendar_next_week}

## Waiting For - Follow Ups
${waiting_followups}

## Someday/Maybe - Activate
${someday_activate}

## Areas of Responsibility
${areas_attention}

## New Areas to Consider
${new_areas}

## Second Brain Review

### Notes Needing Refinement
${brain_refine}

### Notes to Review for Connections
${brain_connections}

### ðŸ”— Notes You Might Want to Link (AI Suggestions)
$(if command -v gtd-brain-suggest-connections &>/dev/null; then
  gtd-brain-suggest-connections weekly 10 2>/dev/null | sed 's/^/  /'
elif [[ -f "$HOME/code/dotfiles/bin/gtd-brain-suggest-connections" ]]; then
  "$HOME/code/dotfiles/bin/gtd-brain-suggest-connections" weekly 10 2>/dev/null | sed 's/^/  /'
else
  echo "  (Connection suggestions not available)"
fi)

### MOCs to Update
${brain_mocs}

### Content to Create (Express Phase)
${brain_express}

## Stats
- Inbox items: ${inbox_count}
- Active projects: ${active_projects}
- Waiting for: ${waiting_count}
- Second Brain notes: ${brain_notes}
  - Project notes: ${brain_projects}
  - Resource notes: ${brain_resources}

EOF
  
  echo "âœ“ Weekly review saved: $review_file"
  echo ""
  
  # Offer AI advice
  read -p "Get AI advice on your weekly review? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    local review_content=$(cat "$review_file")
    if command -v python3 &>/dev/null; then
      local persona_helper="$HOME/code/personal/dotfiles/zsh/functions/gtd_persona_helper.py"
      if [[ -f "$persona_helper" ]]; then
        echo ""
        echo "Getting advice from David Allen (GTD expert)..."
        python3 "$persona_helper" "david" "$review_content" "weekly_review"
        echo ""
        read -p "Get strategic advice from Warren Buffett? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
          python3 "$persona_helper" "warren" "$review_content" "weekly_review"
        fi
      fi
    fi
  fi
}

# Review specific project
review_project() {
  local project_name="$1"
  if [[ -z "$project_name" ]]; then
    echo "Usage: gtd-review project <project-name>"
    exit 1
  fi
  
  project_name=$(echo "$project_name" | tr ' ' '-' | tr '[:upper:]' '[:lower:]')
  local project_dir="${PROJECTS_PATH}/${project_name}"
  local readme="${project_dir}/README.md"
  
  if [[ ! -d "$project_dir" || ! -f "$readme" ]]; then
    echo "âŒ Project not found: $project_name"
    exit 1
  fi
  
  echo ""
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ“ Project Review: $project_name"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  # Show project status
  gtd-project status "$project_name"
  echo ""
  
  # Review questions
  echo "1. What's the current status of this project?"
  read -p "   " project_status
  echo ""
  
  echo "2. What are the next actions?"
  read -p "   " next_actions
  echo ""
  
  echo "3. What's blocking progress?"
  read -p "   " project_blockers
  echo ""
  
  echo "4. What needs to happen next?"
  read -p "   " project_next
  echo ""
  
  # Append to project README
  cat >> "$readme" <<EOF

## Review - ${TODAY}

### Status
${project_status}

### Next Actions
${next_actions}

### Blockers
${project_blockers}

### Next Steps
${project_next}

EOF
  
  echo "âœ“ Review added to project: $project_name"
}

# Monthly review
monthly_review() {
  # Track review timing for preferences learning
  if command -v gtd-preferences-learn &>/dev/null; then
    gtd-preferences-learn track-review "monthly" 2>/dev/null || true
  fi
  
  local month_start=$(date -v1d +"%Y-%m-%d" 2>/dev/null || date -d "first day of this month" +"%Y-%m-%d" 2>/dev/null || date +"%Y-%m-%d")
  local month_end=$(date -v1d -v+1m -v-1d +"%Y-%m-%d" 2>/dev/null || date -d "last day of this month" +"%Y-%m-%d" 2>/dev/null || date +"%Y-%m-%d")
  local month_name=$(date +"%B %Y" 2>/dev/null || echo "This Month")
  
  echo ""
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ“… Monthly Review - $month_name"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  echo "This is a comprehensive monthly review (2-3 hours recommended)."
  echo ""
  echo "See the Monthly Review Guide for detailed tasks:"
  echo "  zsh/MONTHLY_REVIEW_TASKS_GUIDE.md"
  echo ""
  
  # Phase 1: System Cleanup
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ§¹ Phase 1: System Cleanup (30-45 min)"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  echo "1. Archive Completed Projects"
  local projects=($(find "$PROJECTS_PATH" -type d -mindepth 1 -maxdepth 1 2>/dev/null))
  local completed_count=0
  for project_dir in "${projects[@]}"; do
    local readme="${project_dir}/README.md"
    if [[ -f "$readme" ]]; then
      local status=$(grep "^status:" "$readme" 2>/dev/null | head -1 | cut -d':' -f2 | sed 's/^[[:space:]]*//')
      if [[ "$status" == "done" || "$status" == "completed" ]]; then
        ((completed_count++))
      fi
    fi
  done
  
  if [[ $completed_count -gt 0 ]]; then
    echo "   Found $completed_count completed project(s)"
    read -p "   Review and archive completed projects? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
      gtd-project list
      echo ""
      echo "Archive projects with: gtd-project archive \"project-name\""
    fi
  else
    echo "   No completed projects to archive"
  fi
  echo ""
  
  echo "2. Archive Completed Tasks"
  local completed_tasks=$(find "$TASKS_PATH" -type f -name "*.md" -exec grep -l "^status: done" {} \; 2>/dev/null | wc -l | tr -d ' ')
  if [[ $completed_tasks -gt 0 ]]; then
    echo "   Found $completed_tasks completed task(s)"
    read -p "   Review completed tasks? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
      gtd-task list --status=done 2>/dev/null || echo "   Use: gtd-task list to see tasks"
    fi
  else
    echo "   No completed tasks to archive"
  fi
  echo ""
  
  echo "3. Review and Clean Inbox"
  local inbox_count=$(count_items "$INBOX_PATH")
  if [[ $inbox_count -gt 0 ]]; then
    echo "   Inbox has $inbox_count item(s)"
    read -p "   Process inbox now? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
      gtd-process --all
    fi
  else
    echo "   Inbox is empty âœ“"
  fi
  echo ""
  
  # Phase 2: Strategic Assessment
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸŽ¯ Phase 2: Strategic Assessment (45-60 min)"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  echo "4. Comprehensive Project Review"
  read -p "   Review all projects? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    gtd-project list
    echo ""
    echo "For each project, consider:"
    echo "  - Is it still relevant?"
    echo "  - Is it making progress?"
    echo "  - Should it be on hold?"
  fi
  echo ""
  
  echo "5. Comprehensive Area Review"
  read -p "   Review all areas? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    gtd-area review-all
  fi
  echo ""
  
  echo "6. Review Monthly Goals"
  echo "   What goals did you achieve this month?"
  read -p "   " goals_achieved
  echo ""
  echo "   What goals need more work?"
  read -p "   " goals_need_work
  echo ""
  echo "   What goals should you set for next month?"
  read -p "   " next_month_goals
  echo ""
  
  echo "7. Review Habits and Routines"
  read -p "   Review habits dashboard? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    gtd-habit dashboard
  fi
  echo ""
  
  echo "8. Review Financial Status"
  read -p "   Complete monthly financial review? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "   Run: make gtd-wizard â†’ 6) Review â†’ 4) Financial review â†’ 2) Monthly"
  fi
  echo ""
  
  # Phase 3: Pattern Recognition
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ” Phase 3: Pattern Recognition (30-45 min)"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  echo "9. Review Daily Logs"
  echo "   Review the past month's daily logs for patterns and insights."
  read -p "   Review daily logs? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "   Use: gtd-log view to review logs"
    echo "   Look for: patterns, insights, accomplishments"
  fi
  echo ""
  
  echo "10. Review Weekly Reviews"
  echo "    Review all weekly reviews from the month."
  read -p "    Review weekly reviews? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "    Weekly reviews are saved in: ${WEEKLY_REVIEWS_PATH}/"
  fi
  echo ""
  
  echo "11. Review Second Brain"
  read -p "    Review Second Brain? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "    Commands:"
    echo "      gtd-brain list"
    echo "      gtd-brain-moc list"
    echo "      gtd-brain-discover"
  fi
  echo ""
  
  echo "12. Identify Patterns and Trends"
  echo "    What patterns do you see across the month?"
  read -p "    " patterns
  echo ""
  
  # Phase 4: Planning Ahead
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ“… Phase 4: Planning Ahead (30-45 min)"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  echo "13. Set Monthly Goals"
  echo "    What are your top 3-5 goals for next month?"
  read -p "    Goal 1: " goal1
  read -p "    Goal 2: " goal2
  read -p "    Goal 3: " goal3
  echo ""
  
  echo "14. Plan Major Projects"
  echo "    What major projects need attention next month?"
  read -p "    " major_projects
  echo ""
  
  echo "15. Review Calendar"
  echo "    Review past month and plan next month's calendar."
  read -p "    Calendar reviewed? (y/n) " -n 1 -r
  echo
  echo ""
  
  echo "16. Review and Adjust Systems"
  echo "    Is your GTD system working well?"
  read -p "    " system_review
  echo ""
  
  # Reflection
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ’­ Monthly Reflection"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  echo "What went well this month?"
  read -p "   " went_well
  echo ""
  
  echo "What could have gone better?"
  read -p "   " could_improve
  echo ""
  
  echo "What did you learn?"
  read -p "   " learned
  echo ""
  
  echo "What are you grateful for?"
  read -p "   " gratitude
  echo ""
  
  # Save review
  local review_file="${WEEKLY_REVIEWS_PATH}/monthly-${TODAY}.md"
  cat > "$review_file" <<EOF
---
type: monthly_review
date: ${TODAY}
month: ${month_name}
month_start: ${month_start}
month_end: ${month_end}
created: ${TODAY}T${NOW}
---

# Monthly Review - ${month_name}

## Accomplishments This Month
${goals_achieved:-}

## Goals Progress
- Achieved: ${goals_achieved:-}
- Needs Work: ${goals_need_work:-}

## Next Month Goals
1. ${goal1:-}
2. ${goal2:-}
3. ${goal3:-}

## Major Projects for Next Month
${major_projects:-}

## Patterns Identified
${patterns:-}

## Reflection
### What Went Well
${went_well:-}

### What Could Improve
${could_improve:-}

### What I Learned
${learned:-}

### Gratitude
${gratitude:-}

## System Review
${system_review:-}

EOF
  
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  echo "âœ“ Monthly review saved to: $review_file"
  echo ""
  echo "ðŸ“š For detailed monthly review tasks, see:"
  echo "   zsh/MONTHLY_REVIEW_TASKS_GUIDE.md"
  echo ""
}

# Quarterly review
quarterly_review() {
  local current_month=$(date +"%m" 2>/dev/null || echo "01")
  local current_year=$(date +"%Y" 2>/dev/null || echo "2025")
  
  # Determine quarter
  local quarter=1
  if [[ $current_month -ge 4 && $current_month -le 6 ]]; then
    quarter=2
  elif [[ $current_month -ge 7 && $current_month -le 9 ]]; then
    quarter=3
  elif [[ $current_month -ge 10 ]]; then
    quarter=4
  fi
  
  local quarter_name="Q${quarter} ${current_year}"
  
  echo ""
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ”„ Quarterly Review - $quarter_name"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  echo "This is a comprehensive quarterly review (3-4 hours recommended)."
  echo ""
  echo "See the Quarterly Review Guide for detailed tasks:"
  echo "  zsh/QUARTERLY_REVIEW_TASKS_GUIDE.md"
  echo ""
  
  # Phase 1: System Audit
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ§¹ Phase 1: Comprehensive System Audit (60-90 min)"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  echo "1. Complete System Cleanup"
  read -p "   Clean up system? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "   Archiving completed projects and tasks..."
    gtd-project list
    gtd-task list
    echo "   Use archive commands to clean up"
  fi
  echo ""
  
  echo "2. Project Portfolio Review"
  read -p "   Review all projects? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    gtd-project list
    echo ""
    echo "For each project, consider:"
    echo "  - Is it still relevant?"
    echo "  - Should it be paused or canceled?"
    echo "  - Does it align with goals?"
  fi
  echo ""
  
  echo "3. Area Portfolio Review"
  read -p "   Review all areas? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    gtd-area review-all
  fi
  echo ""
  
  # Phase 2: Strategic Assessment
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸŽ¯ Phase 2: Strategic Assessment (60-90 min)"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  echo "4. Quarterly Goals Review"
  echo "   What goals did you achieve this quarter?"
  read -p "   " goals_achieved
  echo ""
  echo "   What goals need more work?"
  read -p "   " goals_need_work
  echo ""
  echo "   What goals should you set for next quarter?"
  read -p "   " next_quarter_goals
  echo ""
  
  echo "5. Habit System Review"
  read -p "   Review habits? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    gtd-habit dashboard
  fi
  echo ""
  
  echo "6. Financial Review"
  read -p "   Complete quarterly financial review? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "   Run: make gtd-wizard â†’ 6) Review â†’ 4) Financial review â†’ 3) Quarterly"
  fi
  echo ""
  
  # Phase 3: Pattern Analysis
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ” Phase 3: Pattern Analysis (45-60 min)"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  echo "7. Review All Daily Logs"
  echo "   Review the entire quarter's daily logs for patterns."
  read -p "   Review daily logs? (y/n) " -n 1 -r
  echo
  echo ""
  
  echo "8. Review All Weekly and Monthly Reviews"
  echo "   Review all reviews from the quarter."
  read -p "   Review reviews? (y/n) " -n 1 -r
  echo
  echo ""
  
  echo "9. Second Brain Comprehensive Review"
  read -p "   Review Second Brain? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "   Commands:"
    echo "     gtd-brain list"
    echo "     gtd-brain-moc list"
    echo "     gtd-brain-discover"
  fi
  echo ""
  
  echo "10. Identify Major Patterns"
  echo "     What major patterns do you see across the quarter?"
  read -p "     " patterns
  echo ""
  
  # Phase 4: Strategic Planning
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ“… Phase 4: Strategic Planning (60-90 min)"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  echo "11. Set Quarterly Goals"
  echo "     What are your top 3-5 goals for next quarter?"
  echo "     (If unsure, focus on what you're already doing or what needs attention)"
  read -p "     Goal 1: " goal1
  read -p "     Goal 2: " goal2
  read -p "     Goal 3: " goal3
  echo ""
  
  echo "12. Plan Major Projects"
  echo "     What major projects need attention next quarter?"
  read -p "     " major_projects
  echo ""
  
  echo "13. Review and Adjust Systems"
  echo "     Is your GTD system working well?"
  read -p "     " system_review
  echo ""
  
  # Reflection
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ’­ Quarterly Reflection"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  echo "What went well this quarter?"
  read -p "   " went_well
  echo ""
  
  echo "What could have gone better?"
  read -p "   " could_improve
  echo ""
  
  echo "What did you learn?"
  read -p "   " learned
  echo ""
  
  echo "What are you grateful for?"
  read -p "   " gratitude
  echo ""
  
  # Save review
  local review_file="${WEEKLY_REVIEWS_PATH}/quarterly-${TODAY}.md"
  cat > "$review_file" <<EOF
---
type: quarterly_review
date: ${TODAY}
quarter: ${quarter_name}
created: ${TODAY}T${NOW}
---

# Quarterly Review - ${quarter_name}

## Accomplishments This Quarter
${goals_achieved:-}

## Goals Progress
- Achieved: ${goals_achieved:-}
- Needs Work: ${goals_need_work:-}

## Next Quarter Goals
1. ${goal1:-}
2. ${goal2:-}
3. ${goal3:-}

## Major Projects for Next Quarter
${major_projects:-}

## Patterns Identified
${patterns:-}

## Reflection
### What Went Well
${went_well:-}

### What Could Improve
${could_improve:-}

### What I Learned
${learned:-}

### Gratitude
${gratitude:-}

## System Review
${system_review:-}

EOF
  
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  echo "âœ“ Quarterly review saved to: $review_file"
  echo ""
  echo "ðŸ“š For detailed quarterly review tasks, see:"
  echo "   zsh/QUARTERLY_REVIEW_TASKS_GUIDE.md"
  echo ""
}

# Yearly review
yearly_review() {
  local current_year=$(date +"%Y" 2>/dev/null || echo "2025")
  
  echo ""
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ“† Yearly Review - ${current_year}"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  echo "This is a comprehensive yearly review (4-6 hours recommended)."
  echo "You can split this over multiple days if needed."
  echo ""
  echo "See the Yearly Review Guide for detailed tasks:"
  echo "  zsh/YEARLY_REVIEW_TASKS_GUIDE.md"
  echo ""
  
  # Phase 1: Year-End Assessment
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ“Š Phase 1: Year-End Assessment (90-120 min)"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  echo "1. Complete Year-End System Cleanup"
  read -p "   Clean up entire system? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "   Archiving all completed items..."
    gtd-project list
    gtd-task list
    echo "   Use archive commands to clean up"
  fi
  echo ""
  
  echo "2. Annual Project Review"
  read -p "   Review all projects from the year? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    gtd-project list
    echo ""
    echo "List completed projects and assess success"
  fi
  echo ""
  
  echo "3. Annual Area Review"
  read -p "   Review all areas comprehensively? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    gtd-area review-all
  fi
  echo ""
  
  # Phase 2: Year-End Analysis
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸŽ¯ Phase 2: Year-End Analysis (90-120 min)"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  echo "4. Annual Goals Review"
  echo "   What were your biggest accomplishments this year?"
  read -p "   " accomplishments
  echo ""
  echo "   What goals did you achieve?"
  read -p "   " goals_achieved
  echo ""
  echo "   What goals did you miss?"
  read -p "   " goals_missed
  echo ""
  
  echo "5. Annual Financial Review"
  read -p "   Complete annual financial review? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "   Run: make gtd-wizard â†’ 6) Review â†’ 4) Financial review â†’ 4) Annual"
  fi
  echo ""
  
  echo "6. Annual Habit Review"
  read -p "   Review all habits? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    gtd-habit dashboard
    echo ""
    echo "Review habit consistency and effectiveness"
  fi
  echo ""
  
  # Phase 3: Year-End Reflection
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ” Phase 3: Year-End Reflection (60-90 min)"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  echo "7. Review All Daily Logs"
  echo "   Review the entire year's daily logs for patterns."
  read -p "   Review daily logs? (y/n) " -n 1 -r
  echo
  echo ""
  
  echo "8. Review All Reviews"
  echo "   Review all weekly, monthly, and quarterly reviews."
  read -p "   Review reviews? (y/n) " -n 1 -r
  echo
  echo ""
  
  echo "9. Second Brain Annual Review"
  read -p "   Review Second Brain comprehensively? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "   Commands:"
    echo "     gtd-brain list"
    echo "     gtd-brain-moc list"
    echo "     gtd-brain-discover"
    echo "     gtd-brain-metrics"
  fi
  echo ""
  
  echo "10. Identify Major Annual Patterns"
  echo "     What major patterns do you see across the year?"
  read -p "     " patterns
  echo ""
  
  # Phase 4: Year-Ahead Planning
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ“… Phase 4: Year-Ahead Planning (90-120 min)"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  echo "11. Set Annual Goals"
  echo "     What are your top 3-5 goals for next year?"
  echo "     (If you don't have clear goals, that's okay! Start with what matters now.)"
  read -p "     Goal 1: " goal1
  read -p "     Goal 2: " goal2
  read -p "     Goal 3: " goal3
  if [[ -z "$goal1" && -z "$goal2" && -z "$goal3" ]]; then
    goal1="Use reviews to discover what matters"
    goal2="Build on what's working"
    goal3="Learn what I want to focus on"
    echo ""
    echo "     ðŸ’¡ That's perfectly fine! Your GTD system will help you discover goals."
    echo "     See: zsh/LIFE_VISION_DISCOVERY_GUIDE.md for guidance."
  fi
  echo ""
  
  echo "12. Plan Major Annual Projects"
  echo "     What major projects need attention next year?"
  read -p "     " major_projects
  echo ""
  
  echo "13. Review and Redesign Systems"
  echo "     Is your GTD system working well? What major improvements?"
  read -p "     " system_review
  echo ""
  
  echo "14. Life Vision and Balance"
  echo "     What's your vision for next year?"
  echo "     (If you don't have one, that's okay! See: zsh/LIFE_VISION_DISCOVERY_GUIDE.md)"
  read -p "     " vision
  if [[ -z "$vision" ]]; then
    vision="No specific vision yet - using reviews to discover what matters"
    echo ""
    echo "     ðŸ’¡ Tip: Your GTD system will help you discover your vision over time."
    echo "     Review your daily logs, projects, and areas to see what matters to you."
  fi
  echo ""
  
  # Reflection
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "ðŸ’­ Annual Reflection"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  
  echo "What went well this year?"
  read -p "   " went_well
  echo ""
  
  echo "What could have gone better?"
  read -p "   " could_improve
  echo ""
  
  echo "What did you learn?"
  read -p "   " learned
  echo ""
  
  echo "What are you grateful for?"
  read -p "   " gratitude
  echo ""
  
  # Save review
  local review_file="${WEEKLY_REVIEWS_PATH}/yearly-${current_year}.md"
  cat > "$review_file" <<EOF
---
type: yearly_review
date: ${TODAY}
year: ${current_year}
created: ${TODAY}T${NOW}
---

# Yearly Review - ${current_year}

## Major Accomplishments
${accomplishments:-}

## Goals Achievement
- Achieved: ${goals_achieved:-}
- Missed: ${goals_missed:-}

## Next Year Goals
1. ${goal1:-}
2. ${goal2:-}
3. ${goal3:-}

## Major Projects for Next Year
${major_projects:-}

## Patterns Identified
${patterns:-}

## Life Vision
${vision:-}

## Reflection
### What Went Well
${went_well:-}

### What Could Improve
${could_improve:-}

### What I Learned
${learned:-}

### Gratitude
${gratitude:-}

## System Review
${system_review:-}

EOF
  
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  echo "âœ“ Yearly review saved to: $review_file"
  echo ""
  echo "ðŸ“š For detailed yearly review tasks, see:"
  echo "   zsh/YEARLY_REVIEW_TASKS_GUIDE.md"
  echo ""
}

# Main
main() {
  case "$1" in
    daily)
      shift
      daily_review "$1"  # Pass argument (morning/evening/auto)
      ;;
    weekly)
      weekly_review
      ;;
    monthly)
      monthly_review
      ;;
    quarterly)
      quarterly_review
      ;;
    yearly|annual)
      yearly_review
      ;;
    project)
      shift
      review_project "$1"
      ;;
    --help|-h|"")
      echo "Usage: gtd-review <type> [options]"
      echo ""
      echo "Types:"
      echo "  daily [morning|evening]   Daily review (auto-detects time if not specified)"
      echo "  weekly                    Weekly review"
      echo "  monthly                   Monthly review"
      echo "  quarterly                 Quarterly review"
      echo "  yearly|annual             Yearly review"
      echo "  project <name>            Review specific project"
      echo ""
      echo "Examples:"
      echo "  gtd-review daily                    # Auto-detects morning/evening"
      echo "  gtd-review daily morning            # Morning review"
      echo "  gtd-review daily evening            # Evening review"
      echo "  gtd-review weekly"
      echo "  gtd-review monthly"
      echo "  gtd-review quarterly"
      echo "  gtd-review yearly"
      echo "  gtd-review project website-redesign"
      exit 0
      ;;
    *)
      echo "Unknown review type: $1"
      echo "Run 'gtd-review --help' for usage"
      exit 1
      ;;
  esac
}

main "$@"



