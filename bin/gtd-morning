#!/bin/bash
# Morning routine - Quick start to your day

# Colors
CYAN='\033[0;36m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BOLD='\033[1m'
NC='\033[0m'

echo ""
echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${BOLD}${CYAN}ðŸŒ… Good Morning! Starting your day...${NC}"
echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo ""

# 1. Check status
make gtd-status

# 2. Process inbox (if items exist)
inbox_count=$(ls -1 ~/Documents/gtd/0-inbox/*.md 2>/dev/null | wc -l | tr -d ' ')
if [[ $inbox_count -gt 0 ]]; then
  echo ""
  read -p "Process inbox now? (y/n) " -n 1 -r
  echo
  if [[ $REPLY =~ ^[Yy]$ ]]; then
    gtd-process
  fi
fi

# 3. Show today's focus
echo ""
echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
echo -e "${BOLD}${CYAN}ðŸ“‹ Today's Focus${NC}"
echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
gtd-task list --priority=urgent_important 2>/dev/null | head -5 || echo "  (none)"
echo ""

# 4. Quick log entry
read -p "Quick morning log entry (or press Enter to skip): " log_entry
if [[ -n "$log_entry" ]]; then
  # Use gtd-daily-log script (standalone version of addInfoToDailyLog)
  # This works in bash scripts, unlike the zsh function
  if command -v gtd-daily-log &>/dev/null; then
    gtd-daily-log "$log_entry"
  elif [[ -f "$HOME/code/dotfiles/bin/gtd-daily-log" ]]; then
    "$HOME/code/dotfiles/bin/gtd-daily-log" "$log_entry"
  elif [[ -f "$HOME/code/personal/dotfiles/bin/gtd-daily-log" ]]; then
    "$HOME/code/personal/dotfiles/bin/gtd-daily-log" "$log_entry"
  elif command -v addInfoToDailyLog &>/dev/null || type addInfoToDailyLog &>/dev/null 2>/dev/null; then
    addInfoToDailyLog "$log_entry"
  else
    echo "âš ï¸  Daily log command not found. Using fallback..."
    # Fallback: implement basic logging directly
    local log_dir="${DAILY_LOG_DIR:-$HOME/Documents/daily_logs}"
    local today=$(date +"%Y-%m-%d")
    local current_time=$(date +"%H:%M")
    local log_file="${log_dir}/${today}.txt"
    mkdir -p "$log_dir"
    if [[ ! -f "$log_file" ]]; then
      echo "# Daily Log - $today" > "$log_file"
      echo "" >> "$log_file"
    fi
    echo "${current_time} - ${log_entry}" >> "$log_file"
    echo "âœ“ Added: ${current_time} - ${log_entry}"
  fi
fi

echo ""
echo -e "${GREEN}âœ… Morning routine complete!${NC}"
echo ""

