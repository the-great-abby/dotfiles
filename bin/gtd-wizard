#!/bin/bash
# GTD Interactive Wizard - Guides you through GTD processes

# Load GTD config
GTD_CONFIG_FILE="$HOME/.gtd_config"
if [[ -f "$HOME/code/personal/dotfiles/zsh/.gtd_config" ]]; then
  GTD_CONFIG_FILE="$HOME/code/personal/dotfiles/zsh/.gtd_config"
elif [[ -f "$HOME/code/dotfiles/zsh/.gtd_config" ]]; then
  GTD_CONFIG_FILE="$HOME/code/dotfiles/zsh/.gtd_config"
fi

# Source config if it exists
if [[ -f "$GTD_CONFIG_FILE" ]]; then
  source "$GTD_CONFIG_FILE"
fi

# Default values
SECOND_BRAIN="${SECOND_BRAIN:-$HOME/Documents/obsidian/Second Brain}"
GTD_BASE_DIR="${GTD_BASE_DIR:-$HOME/Documents/gtd}"
PROJECTS_PATH="${GTD_BASE_DIR}/1-projects"
AREAS_PATH="${GTD_BASE_DIR}/2-areas"

# Source selection helper
SELECT_HELPER="$HOME/code/dotfiles/bin/gtd-select-helper.sh"
if [[ ! -f "$SELECT_HELPER" && -f "$HOME/code/personal/dotfiles/bin/gtd-select-helper.sh" ]]; then
  SELECT_HELPER="$HOME/code/personal/dotfiles/bin/gtd-select-helper.sh"
fi
if [[ -f "$SELECT_HELPER" ]]; then
  source "$SELECT_HELPER"
fi

# Colors
CYAN='\033[0;36m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
BOLD='\033[1m'
NC='\033[0m'

# Clear screen
clear

# Main menu
show_main_menu() {
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ§  GTD Interactive Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo -e "${BOLD}What would you like to do?${NC}"
  echo ""
  echo -e "${GREEN}1)${NC} ğŸ“¥ Capture something to inbox"
  echo -e "${GREEN}2)${NC} ğŸ“‹ Process inbox items"
  echo -e "${GREEN}3)${NC} âœ… Manage tasks"
  echo -e "${GREEN}4)${NC} ğŸ“ Manage projects"
  echo -e "${GREEN}5)${NC} ğŸ¯ Manage areas of responsibility"
  echo -e "${GREEN}6)${NC} ğŸ“Š Review (daily/weekly)"
  echo -e "${GREEN}7)${NC} ğŸ§  Sync with Second Brain"
  echo -e "${GREEN}8)${NC} ğŸ—ºï¸  Manage MOCs (Maps of Content)"
  echo -e "${GREEN}9)${NC} âœï¸  Express Phase (create content from notes)"
  echo -e "${GREEN}10)${NC} ğŸ“‹ Use Templates"
  echo -e "${GREEN}11)${NC} ğŸ¤– Get advice from personas"
  echo -e "${GREEN}12)${NC} ğŸ“š Learn Organization System (Zettelkasten + GTD + Second Brain)"
  echo -e "${GREEN}13)${NC} ğŸ§  Learn Second Brain (where to start)"
  echo -e "${GREEN}14)${NC} ğŸ¯ Discover Life Vision (if you don't have a plan)"
  echo -e "${GREEN}15)${NC} ğŸ“ Log to daily log"
  echo -e "${GREEN}16)${NC} ğŸ” Search GTD system"
  echo -e "${GREEN}17)${NC} ğŸ“Š System status"
  echo -e "${GREEN}18)${NC} ğŸ” Manage habits & recurring tasks"
  echo -e "${GREEN}19)${NC} ğŸŒ… Morning/Evening Check-In"
  echo -e "${GREEN}20)${NC} â˜¸ï¸  Learn Kubernetes/CKA"
  echo -e "${GREEN}21)${NC} ğŸ¨ Create diagrams & mindmaps"
  echo -e "${GREEN}22)${NC} ğŸ”— Zettelkasten (atomic notes)"
  echo -e "${GREEN}23)${NC} ğŸ¤– AI Suggestions & MCP Tools"
  echo ""
  echo -e "${YELLOW}0)${NC} Exit"
  echo ""
  echo -n "Choose: "
}

# Capture wizard
capture_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ“¥ Capture Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What type of item are you capturing?"
  echo ""
  echo "  1) Task (actionable item)"
  echo "  2) Idea (someday/maybe)"
  echo "  3) Reference (information to keep)"
  echo "  4) Link (URL to save)"
  echo "  5) Call (phone call notes)"
  echo "  6) Email (email action)"
  echo "  7) General note"
  echo "  8) Zettelkasten note (atomic idea)"
  echo "  9) Daily log entry"
  echo ""
  echo -n "Choose: "
  read capture_type
  
  echo ""
  echo -n "What do you want to capture? "
  read capture_content
  
  if [[ -z "$capture_content" ]]; then
    echo "âŒ No content provided"
    return 1
  fi
  
  case "$capture_type" in
    1)
      gtd-capture --type=task "$capture_content"
      ;;
    2)
      gtd-capture --type=idea "$capture_content"
      ;;
    3)
      gtd-capture --type=reference "$capture_content"
      ;;
    4)
      gtd-capture --type=link "$capture_content"
      ;;
    5)
      gtd-capture --type=call "$capture_content"
      ;;
    6)
      gtd-capture --type=email "$capture_content"
      ;;
    7)
      gtd-capture "$capture_content"
      ;;
    8)
      zet "$capture_content"
      ;;
    9)
      # Use gtd-daily-log script (standalone version of addInfoToDailyLog)
      if command -v gtd-daily-log &>/dev/null; then
        gtd-daily-log "$capture_content"
      elif [[ -f "$HOME/code/dotfiles/bin/gtd-daily-log" ]]; then
        "$HOME/code/dotfiles/bin/gtd-daily-log" "$capture_content"
      elif [[ -f "$HOME/code/personal/dotfiles/bin/gtd-daily-log" ]]; then
        "$HOME/code/personal/dotfiles/bin/gtd-daily-log" "$capture_content"
      elif command -v addInfoToDailyLog &>/dev/null || type addInfoToDailyLog &>/dev/null 2>/dev/null; then
        addInfoToDailyLog "$capture_content"
      else
        echo "âŒ Daily log command not found. Using fallback..."
        # Fallback: implement basic logging directly
        local log_dir="${DAILY_LOG_DIR:-$HOME/Documents/daily_logs}"
        local today=$(date +"%Y-%m-%d")
        local current_time=$(date +"%H:%M")
        local log_file="${log_dir}/${today}.txt"
        mkdir -p "$log_dir"
        if [[ ! -f "$log_file" ]]; then
          echo "# Daily Log - $today" > "$log_file"
          echo "" >> "$log_file"
        fi
        echo "${current_time} - ${capture_content}" >> "$log_file"
        echo "âœ“ Added: ${current_time} - ${capture_content}"
      fi
      ;;
    *)
      gtd-capture "$capture_content"
      ;;
  esac
  
  echo ""
  echo "âœ“ Captured! Press Enter to continue..."
  read
}

# Process wizard
process_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ“‹ Process Inbox Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  
  # Check inbox count
  local inbox_count=$(ls -1 ~/Documents/gtd/0-inbox/*.md 2>/dev/null | wc -l | tr -d ' ')
  
  if [[ "$inbox_count" -eq 0 ]]; then
    echo "âœ… Your inbox is empty!"
    echo ""
    echo "Press Enter to continue..."
    read
    return 0
  fi
  
  echo "You have ${inbox_count} item(s) in your inbox."
  echo ""
  echo "Starting inbox processing..."
  echo ""
  
  gtd-process
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Task wizard
task_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}âœ… Task Management Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What would you like to do?"
  echo ""
  echo "  1) Add a new task"
  echo "  2) List tasks"
  echo "  3) Complete a task"
  echo "  4) Update a task"
  echo "  5) Move task to project"
  echo ""
  echo -n "Choose: "
  read task_choice
  
  case "$task_choice" in
    1)
      echo ""
      echo -n "Task description: "
      read task_desc
      
      if [[ -z "$task_desc" ]]; then
        echo "âŒ No task description provided"
        return 1
      fi
      
      echo ""
      echo "Optional: Link to a project?"
      echo ""
      local project_name=""
      if [[ -d "$PROJECTS_PATH" ]] && [[ -n "$(find "$PROJECTS_PATH" -type d -mindepth 1 -maxdepth 1 2>/dev/null)" ]]; then
        echo "Available projects:"
        selected_project=$(select_from_list "project" "$PROJECTS_PATH" "project")
        if [[ -n "$selected_project" ]]; then
          # Convert display name to slug format
          project_name=$(echo "$selected_project" | tr ' ' '-' | tr '[:upper:]' '[:lower:]')
        fi
      else
        echo -n "Project name (or press Enter to skip): "
        read project_input
        if [[ -n "$project_input" ]]; then
          project_name="$project_input"
        fi
      fi
      
      echo ""
      echo -n "Repository URL (GitHub/GitLab, or press Enter to skip): "
      read repo_url
      
      if [[ -n "$project_name" ]]; then
        if [[ -n "$repo_url" ]]; then
          gtd-task add "$task_desc" --project="$project_name" --repository="$repo_url"
        else
          gtd-task add "$task_desc" --project="$project_name"
        fi
      else
        if [[ -n "$repo_url" ]]; then
          gtd-task add "$task_desc" --repository="$repo_url"
        else
          gtd-task add "$task_desc"
        fi
      fi
      ;;
    2)
      echo ""
      echo "What type of tasks would you like to review?"
      echo ""
      echo "  1) All tasks"
      echo "  2) Tasks with projects (project-related)"
      echo "  3) Tasks without projects (standalone tasks)"
      echo ""
      echo -n "Choose: "
      read list_choice
      
      case "$list_choice" in
        1)
          echo ""
          gtd-task list
          ;;
        2)
          echo ""
          gtd-task list --project-only
          ;;
        3)
          echo ""
          gtd-task list --no-project
          ;;
        *)
          echo ""
          gtd-task list
          ;;
      esac
      ;;
    3)
      echo ""
      gtd-task list
      echo ""
      echo -n "Task number to complete: "
      read task_num
      gtd-task complete "$task_num"
      ;;
    4)
      echo ""
      gtd-task list
      echo ""
      echo -n "Task number to update: "
      read task_num
      echo -n "New description: "
      read new_desc
      gtd-task update "$task_num" "$new_desc"
      ;;
    5)
      echo ""
      echo "Moving a task to a project..."
      echo ""
      gtd-task list
      echo ""
      echo "ğŸ’¡ Look at the task list above. Each task shows an 'ID:' line."
      echo "   Copy the task ID (e.g., 20240101120000-task) and paste it below."
      echo ""
      echo -n "Task ID to move (copy from the list above): "
      read task_id
      
      if [[ -z "$task_id" ]]; then
        echo "âŒ No task ID provided"
        return 1
      fi
      
      echo ""
      if [[ -d "$PROJECTS_PATH" ]] && [[ -n "$(find "$PROJECTS_PATH" -type d -mindepth 1 -maxdepth 1 2>/dev/null)" ]]; then
        echo "Select project to move task to:"
        project_name=$(select_from_list "project" "$PROJECTS_PATH" "project")
        if [[ -n "$project_name" ]]; then
          # Convert to slug format
          project_slug=$(echo "$project_name" | tr ' ' '-' | tr '[:upper:]' '[:lower:]')
          gtd-task move "$task_id" "$project_slug"
        fi
      else
        echo -n "Project name (or press Enter to skip): "
        read project_input
        if [[ -n "$project_input" ]]; then
          gtd-task move "$task_id" "$project_input"
        fi
      fi
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Area wizard
area_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ¯ Areas of Responsibility Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What would you like to do?"
  echo ""
  echo "  1) Create a new area"
  echo "  2) Use starter areas wizard (recommended)"
  echo "  3) List areas"
  echo "  4) View an area"
  echo "  5) Update an area"
  echo "  6) Archive an area"
  echo "  7) Review all areas"
  echo ""
  echo -n "Choose: "
  read area_choice
  
  case "$area_choice" in
    1)
      echo ""
      echo -n "Area name: "
      read area_name
      
      if [[ -z "$area_name" ]]; then
        echo "âŒ No area name provided"
        return 1
      fi
      
      echo ""
      echo -n "Area description (optional): "
      read area_desc
      
      if [[ -n "$area_desc" ]]; then
        gtd-area create "$area_name" "$area_desc"
      else
        gtd-area create "$area_name"
      fi
      ;;
    2)
      gtd-area-starter
      ;;
    3)
      echo ""
      gtd-area list
      ;;
    4)
      echo ""
      if [[ -d "$AREAS_PATH" ]] && [[ -n "$(find "$AREAS_PATH" -type f -name "*.md" 2>/dev/null)" ]]; then
        area_name=$(select_from_list "area" "$AREAS_PATH" "name")
        if [[ -n "$area_name" ]]; then
          gtd-area view "$area_name"
        fi
      else
        echo "No areas found."
      fi
      ;;
    5)
      echo ""
      if [[ -d "$AREAS_PATH" ]] && [[ -n "$(find "$AREAS_PATH" -type f -name "*.md" 2>/dev/null)" ]]; then
        area_name=$(select_from_list "area" "$AREAS_PATH" "name")
        if [[ -n "$area_name" ]]; then
          echo -n "New description: "
          read new_desc
          if [[ -n "$new_desc" ]]; then
            gtd-area update "$area_name" "$new_desc"
          fi
        fi
      else
        echo "No areas found."
      fi
      ;;
    6)
      echo ""
      if [[ -d "$AREAS_PATH" ]] && [[ -n "$(find "$AREAS_PATH" -type f -name "*.md" 2>/dev/null)" ]]; then
        area_name=$(select_from_list "area" "$AREAS_PATH" "name")
        if [[ -n "$area_name" ]]; then
          gtd-area archive "$area_name"
        fi
      else
        echo "No areas found."
      fi
      ;;
    7)
      echo ""
      echo "Reviewing all areas..."
      gtd-area review-all
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Project wizard
project_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ“ Project Management Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What would you like to do?"
  echo ""
  echo "  1) Create a new project"
  echo "  2) List projects"
  echo "  3) View a project"
  echo "  4) Add task to project"
  echo "  5) Update project status"
  echo "  6) Move project to area"
  echo "  7) Archive a project"
  echo ""
  echo -n "Choose: "
  read project_choice
  
  case "$project_choice" in
    1)
      echo ""
      echo -n "Project name: "
      read project_name
      
      if [[ -z "$project_name" ]]; then
        echo "âŒ No project name provided"
        return 1
      fi
      
      echo ""
      echo -n "Repository URL (GitHub/GitLab, or press Enter to skip): "
      read repo_url
      
      if [[ -n "$repo_url" ]]; then
        gtd-project create "$project_name" --repository="$repo_url"
      else
        gtd-project create "$project_name"
      fi
      ;;
    2)
      echo ""
      gtd-project list
      ;;
    3)
      echo ""
      if [[ -d "$PROJECTS_PATH" ]] && [[ -n "$(find "$PROJECTS_PATH" -type d -mindepth 1 -maxdepth 1 2>/dev/null)" ]]; then
        project_name=$(select_from_list "project" "$PROJECTS_PATH" "project")
        if [[ -n "$project_name" ]]; then
          # Convert to slug format
          project_slug=$(echo "$project_name" | tr ' ' '-' | tr '[:upper:]' '[:lower:]')
          gtd-project view "$project_slug"
        fi
      else
        echo "No projects found."
      fi
      ;;
    4)
      echo ""
      if [[ -d "$PROJECTS_PATH" ]] && [[ -n "$(find "$PROJECTS_PATH" -type d -mindepth 1 -maxdepth 1 2>/dev/null)" ]]; then
        project_name=$(select_from_list "project" "$PROJECTS_PATH" "project")
        if [[ -n "$project_name" ]]; then
          echo -n "Task description: "
          read task_desc
          if [[ -n "$task_desc" ]]; then
            # Convert to slug format
            project_slug=$(echo "$project_name" | tr ' ' '-' | tr '[:upper:]' '[:lower:]')
            gtd-project add-task "$project_slug" "$task_desc"
          fi
        fi
      else
        echo "No projects found."
      fi
      ;;
    5)
      echo ""
      if [[ -d "$PROJECTS_PATH" ]] && [[ -n "$(find "$PROJECTS_PATH" -type d -mindepth 1 -maxdepth 1 2>/dev/null)" ]]; then
        project_name=$(select_from_list "project" "$PROJECTS_PATH" "project")
        if [[ -n "$project_name" ]]; then
          echo -n "New status: "
          read new_status
          if [[ -n "$new_status" ]]; then
            # Convert to slug format
            project_slug=$(echo "$project_name" | tr ' ' '-' | tr '[:upper:]' '[:lower:]')
            gtd-project status "$project_slug" "$new_status"
          fi
        fi
      else
        echo "No projects found."
      fi
      ;;
    6)
      echo ""
      echo "Moving a project to an area..."
      echo ""
      if [[ -d "$PROJECTS_PATH" ]] && [[ -n "$(find "$PROJECTS_PATH" -type d -mindepth 1 -maxdepth 1 2>/dev/null)" ]]; then
        echo "Select project to move:"
        project_name=$(select_from_list "project" "$PROJECTS_PATH" "project")
        if [[ -n "$project_name" ]]; then
          # Convert to slug format
          project_slug=$(echo "$project_name" | tr ' ' '-' | tr '[:upper:]' '[:lower:]')
          
          echo ""
          if [[ -d "$AREAS_PATH" ]] && [[ -n "$(find "$AREAS_PATH" -type f -name "*.md" 2>/dev/null)" ]]; then
            echo "Select area to assign project to:"
            area_name=$(select_from_list "area" "$AREAS_PATH" "name")
            if [[ -n "$area_name" ]]; then
              # Convert to slug format
              area_slug=$(echo "$area_name" | tr ' ' '-' | tr '[:upper:]' '[:lower:]')
              gtd-area add-project "$area_slug" "$project_slug"
            fi
          else
            echo -n "Area name (or press Enter to skip): "
            read area_input
            if [[ -n "$area_input" ]]; then
              area_slug=$(echo "$area_input" | tr ' ' '-' | tr '[:upper:]' '[:lower:]')
              gtd-area add-project "$area_slug" "$project_slug"
            fi
          fi
        fi
      else
        echo "No projects found."
      fi
      ;;
    7)
      echo ""
      if [[ -d "$PROJECTS_PATH" ]] && [[ -n "$(find "$PROJECTS_PATH" -type d -mindepth 1 -maxdepth 1 2>/dev/null)" ]]; then
        project_name=$(select_from_list "project" "$PROJECTS_PATH" "project")
        if [[ -n "$project_name" ]]; then
          # Convert to slug format
          project_slug=$(echo "$project_name" | tr ' ' '-' | tr '[:upper:]' '[:lower:]')
          gtd-project archive "$project_slug"
        fi
      else
        echo "No projects found."
      fi
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Review wizard
review_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ“Š Review Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What type of review?"
  echo ""
  echo "  1) Daily review"
  echo "  2) Weekly review"
  echo "  3) ğŸ“… Monthly review"
  echo "  4) ğŸ”„ Quarterly review"
  echo "  5) ğŸ“† Yearly review"
  echo "  6) ğŸ’° Financial review (weekly/monthly/quarterly/annual)"
  echo ""
  echo -n "Choose: "
  read review_type
  
  case "$review_type" in
    1)
      gtd-review daily
      ;;
    2)
      gtd-review weekly
      ;;
    3)
      gtd-review monthly
      ;;
    4)
      gtd-review quarterly
      ;;
    5)
      gtd-review yearly
      ;;
    6)
      financial_review_wizard
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Sync wizard
sync_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ§  Second Brain Sync Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What would you like to sync?"
  echo ""
  echo "  1) Full sync (projects, areas, references)"
  echo "  2) Projects only"
  echo "  3) Areas only"
  echo "  4) References only"
  echo ""
  echo -n "Choose: "
  read sync_choice
  
  case "$sync_choice" in
    1)
      gtd-brain-sync
      ;;
    2)
      gtd-brain-sync projects
      ;;
    3)
      gtd-brain-sync areas
      ;;
    4)
      gtd-brain-sync references
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Advice wizard
advice_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ¤– Get Advice Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "How would you like to get advice?"
  echo ""
  echo "  1) Random persona"
  echo "  2) Specific persona"
  echo "  3) All personas"
  echo "  4) Review daily log"
  echo ""
  echo -n "Choose: "
  read advice_choice
  
  case "$advice_choice" in
    1)
      echo ""
      echo -n "What do you need advice about? "
      read question
      gtd-advise --random "$question"
      ;;
    2)
      echo ""
      echo "Available personas:"
      gtd-advise --list
      echo ""
      echo -n "Persona name: "
      read persona
      echo -n "Your question: "
      read question
      gtd-advise "$persona" "$question"
      ;;
    3)
      echo ""
      echo -n "What do you need advice about? "
      read question
      gtd-advise --all "$question"
      ;;
    4)
      echo ""
      echo "Reviewing your daily log..."
      gtd-advise --daily-log
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Daily log wizard
log_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ“ Daily Log Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo -n "What would you like to log? "
  read log_entry
  
  if [[ -z "$log_entry" ]]; then
    echo "âŒ No entry provided"
    return 1
  fi
  
  # Use gtd-daily-log script (standalone version of addInfoToDailyLog)
  if command -v gtd-daily-log &>/dev/null; then
    gtd-daily-log "$log_entry"
  elif [[ -f "$HOME/code/dotfiles/bin/gtd-daily-log" ]]; then
    "$HOME/code/dotfiles/bin/gtd-daily-log" "$log_entry"
  elif [[ -f "$HOME/code/personal/dotfiles/bin/gtd-daily-log" ]]; then
    "$HOME/code/personal/dotfiles/bin/gtd-daily-log" "$log_entry"
  elif command -v addInfoToDailyLog &>/dev/null || type addInfoToDailyLog &>/dev/null 2>/dev/null; then
    addInfoToDailyLog "$log_entry"
  else
    echo "âŒ Daily log command not found."
    echo "   Trying fallback method..."
    # Fallback: implement basic logging directly
    local log_dir="${DAILY_LOG_DIR:-$HOME/Documents/daily_logs}"
    local today=$(date +"%Y-%m-%d")
    local current_time=$(date +"%H:%M")
    local log_file="${log_dir}/${today}.txt"
    mkdir -p "$log_dir"
    if [[ ! -f "$log_file" ]]; then
      echo "# Daily Log - $today" > "$log_file"
      echo "" >> "$log_file"
    fi
    echo "${current_time} - ${log_entry}" >> "$log_file"
    echo "âœ“ Added: ${current_time} - ${log_entry}"
  fi
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Search wizard
search_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ” Search Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What would you like to search?"
  echo ""
  echo "  1) Search GTD system"
  echo "  2) Search Second Brain"
  echo ""
  echo -n "Choose: "
  read search_choice
  
  case "$search_choice" in
    1)
      echo ""
      echo -n "Search term: "
      read search_term
      gtd-search "$search_term"
      ;;
    2)
      echo ""
      echo -n "Search term: "
      read search_term
      gtd-brain search "$search_term"
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Status wizard
status_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ“Š System Status${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What status would you like to check?"
  echo ""
  echo "  1) Basic GTD System Status"
  echo "  2) MCP Server & AI System Status"
  echo "  3) Background Worker Status"
  echo "  4) Full System Status (All Checks)"
  echo "  5) ğŸš€ Kubernetes Deployment Status"
  echo ""
  echo -n "Choose: "
  read status_choice
  
  case "$status_choice" in
    1)
      clear
      echo ""
      echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo -e "${BOLD}${CYAN}ğŸ“Š Basic GTD System Status${NC}"
      echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo ""
      
      # Inbox count
      local inbox_count=$(ls -1 ~/Documents/gtd/0-inbox/*.md 2>/dev/null | wc -l | tr -d ' ')
      echo -e "${BOLD}Inbox:${NC} ${inbox_count} item(s)"
      
      # Projects count
      local projects_count=$(ls -1 ~/Documents/gtd/1-projects/*/README.md 2>/dev/null | wc -l | tr -d ' ')
      echo -e "${BOLD}Active Projects:${NC} ${projects_count}"
      
      # Tasks count
      local tasks_count=$(find ~/Documents/gtd/tasks -name "*.md" -type f 2>/dev/null | wc -l | tr -d ' ')
      echo -e "${BOLD}Active Tasks:${NC} ${tasks_count}"
      
      # Today's log entries
      local today=$(date +"%Y-%m-%d")
      local log_file="$HOME/Documents/daily_logs/${today}.txt"
      local log_count=0
      if [[ -f "$log_file" ]]; then
        log_count=$(grep -c "^[0-9][0-9]:[0-9][0-9]" "$log_file" 2>/dev/null || echo "0")
      fi
      echo -e "${BOLD}Today's Log Entries:${NC} ${log_count}"
      
      # Areas count
      local areas_count=$(ls -1 ~/Documents/gtd/2-areas/*.md 2>/dev/null | wc -l | tr -d ' ')
      echo -e "${BOLD}Areas:${NC} ${areas_count}"
      ;;
    2)
      clear
      echo ""
      echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo -e "${BOLD}${CYAN}ğŸ¤– MCP Server & AI System Status${NC}"
      echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo ""
      
      # Check LM Studio
      echo -e "${BOLD}LM Studio (Fast Model):${NC}"
      if curl -s "http://localhost:1234/v1/models" >/dev/null 2>&1; then
        echo -e "  ${GREEN}âœ… Running${NC}"
        models=$(curl -s "http://localhost:1234/v1/models" 2>/dev/null | python3 -c "import sys, json; data=json.load(sys.stdin); print(', '.join([m.get('id', 'unknown')[:30] for m in data.get('data', [])[:3]]))" 2>/dev/null || echo "unknown")
        echo "  Models: $models"
      else
        echo -e "  ${RED}âŒ Not running${NC}"
        echo "  â†’ Start LM Studio and load a model"
      fi
      echo ""
      
      # Check MCP dependencies
      echo -e "${BOLD}MCP Dependencies:${NC}"
      if python3 -c "import mcp" 2>/dev/null; then
        echo -e "  ${GREEN}âœ… MCP SDK installed${NC}"
      else
        echo -e "  ${RED}âŒ MCP SDK not installed${NC}"
        echo "  â†’ Run: pip3 install mcp"
      fi
      echo ""
      
      # Check pending suggestions
      echo -e "${BOLD}Pending Suggestions:${NC}"
      SUGGESTIONS_DIR="${GTD_BASE_DIR}/suggestions"
      if [[ -d "$SUGGESTIONS_DIR" ]]; then
        pending_count=$(find "$SUGGESTIONS_DIR" -name "*.json" -exec grep -l '"status":\s*"pending"' {} \; 2>/dev/null | wc -l | tr -d ' ')
        if [[ "$pending_count" -gt 0 ]]; then
          echo -e "  ${YELLOW}âš ï¸  $pending_count pending${NC}"
        else
          echo -e "  ${GREEN}âœ… None pending${NC}"
        fi
      else
        echo -e "  ${CYAN}â„¹ï¸  No suggestions yet${NC}"
      fi
      echo ""
      
      echo -e "${CYAN}Note:${NC} Check Cursor MCP status indicator for server connection"
      ;;
    3)
      clear
      echo ""
      echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo -e "${BOLD}${CYAN}âš™ï¸  Background Worker Status${NC}"
      echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo ""
      
      # Check Kubernetes
      echo -e "${BOLD}Kubernetes Worker:${NC}"
      if command -v kubectl &>/dev/null; then
        if kubectl get deployment gtd-deep-analysis-worker &>/dev/null 2>&1; then
          replicas=$(kubectl get deployment gtd-deep-analysis-worker -o jsonpath='{.status.readyReplicas}' 2>/dev/null || echo "0")
          desired=$(kubectl get deployment gtd-deep-analysis-worker -o jsonpath='{.spec.replicas}' 2>/dev/null || echo "0")
          if [[ "$replicas" -gt 0 && "$replicas" == "$desired" ]]; then
            echo -e "  ${GREEN}âœ… Running ($replicas/$desired)${NC}"
          else
            echo -e "  ${YELLOW}âš ï¸  Not fully ready ($replicas/$desired)${NC}"
          fi
        else
          echo -e "  ${CYAN}â„¹ï¸  Not deployed${NC}"
        fi
      else
        echo -e "  ${CYAN}â„¹ï¸  kubectl not available${NC}"
      fi
      echo ""
      
      # Check local worker
      echo -e "${BOLD}Local Worker Process:${NC}"
      if pgrep -f "gtd_deep_analysis_worker.py" >/dev/null; then
        pid=$(pgrep -f "gtd_deep_analysis_worker.py")
        echo -e "  ${GREEN}âœ… Running (PID: $pid)${NC}"
      else
        echo -e "  ${CYAN}â„¹ï¸  Not running${NC}"
        echo "  â†’ Start with: python3 mcp/gtd_deep_analysis_worker.py file"
      fi
      echo ""
      
      # Check queue
      echo -e "${BOLD}Queue Status:${NC}"
      QUEUE_FILE="${HOME}/Documents/gtd/deep_analysis_queue.jsonl"
      if [[ -f "$QUEUE_FILE" ]]; then
        queue_count=$(wc -l < "$QUEUE_FILE" 2>/dev/null || echo "0")
        if [[ "$queue_count" -gt 0 ]]; then
          echo -e "  ${YELLOW}âš ï¸  $queue_count item(s) in queue${NC}"
        else
          echo -e "  ${GREEN}âœ… Queue empty${NC}"
        fi
      else
        echo -e "  ${CYAN}â„¹ï¸  No queue file${NC}"
      fi
      echo ""
      
      # Check results
      echo -e "${BOLD}Analysis Results:${NC}"
      RESULTS_DIR="${HOME}/Documents/gtd/deep_analysis_results"
      if [[ -d "$RESULTS_DIR" ]]; then
        result_count=$(find "$RESULTS_DIR" -name "*.json" 2>/dev/null | wc -l | tr -d ' ')
        if [[ "$result_count" -gt 0 ]]; then
          echo -e "  ${GREEN}âœ… $result_count result(s)${NC}"
          latest=$(ls -t "$RESULTS_DIR"/*.json 2>/dev/null | head -1)
          if [[ -n "$latest" ]]; then
            echo "  Latest: $(basename "$latest")"
          fi
        else
          echo -e "  ${CYAN}â„¹ï¸  No results yet${NC}"
        fi
      else
        echo -e "  ${CYAN}â„¹ï¸  No results directory${NC}"
      fi
      ;;
    4)
      clear
      # Run full status check script if available
      STATUS_SCRIPT="$HOME/code/dotfiles/mcp/gtd_mcp_status.sh"
      if [[ ! -f "$STATUS_SCRIPT" ]]; then
        STATUS_SCRIPT="$HOME/code/personal/dotfiles/mcp/gtd_mcp_status.sh"
      fi
      
      if [[ -f "$STATUS_SCRIPT" ]]; then
        bash "$STATUS_SCRIPT"
      else
        echo ""
        echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
        echo -e "${BOLD}${CYAN}ğŸ“Š Full System Status${NC}"
        echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
        echo ""
        echo "Status script not found. Showing basic status instead..."
        echo ""
        
        # Show basic status
        local inbox_count=$(ls -1 ~/Documents/gtd/0-inbox/*.md 2>/dev/null | wc -l | tr -d ' ')
        echo -e "${BOLD}Inbox:${NC} ${inbox_count} item(s)"
        
        local projects_count=$(ls -1 ~/Documents/gtd/1-projects/*/README.md 2>/dev/null | wc -l | tr -d ' ')
        echo -e "${BOLD}Active Projects:${NC} ${projects_count}"
        
        local tasks_count=$(find ~/Documents/gtd/tasks -name "*.md" -type f 2>/dev/null | wc -l | tr -d ' ')
        echo -e "${BOLD}Active Tasks:${NC} ${tasks_count}"
      fi
      ;;
    5)
      clear
      echo ""
      echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo -e "${BOLD}${CYAN}â˜¸ï¸  Kubernetes Deployment Status${NC}"
      echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo ""
      
      DEPLOY_SCRIPT="$HOME/code/dotfiles/mcp/deploy.sh"
      if [[ ! -f "$DEPLOY_SCRIPT" ]]; then
        DEPLOY_SCRIPT="$HOME/code/personal/dotfiles/mcp/deploy.sh"
      fi
      
      if [[ -f "$DEPLOY_SCRIPT" ]]; then
        bash "$DEPLOY_SCRIPT" status
      else
        echo "âŒ Deployment script not found"
        echo ""
        echo "Location checked: $DEPLOY_SCRIPT"
      fi
      ;;
    *)
      # Default to basic status if invalid choice
      clear
      echo ""
      echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo -e "${BOLD}${CYAN}ğŸ“Š Basic GTD System Status${NC}"
      echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo ""
      
      local inbox_count=$(ls -1 ~/Documents/gtd/0-inbox/*.md 2>/dev/null | wc -l | tr -d ' ')
      echo -e "${BOLD}Inbox:${NC} ${inbox_count} item(s)"
      
      local projects_count=$(ls -1 ~/Documents/gtd/1-projects/*/README.md 2>/dev/null | wc -l | tr -d ' ')
      echo -e "${BOLD}Active Projects:${NC} ${projects_count}"
      
      local tasks_count=$(find ~/Documents/gtd/tasks -name "*.md" -type f 2>/dev/null | wc -l | tr -d ' ')
      echo -e "${BOLD}Active Tasks:${NC} ${tasks_count}"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# MOC wizard
moc_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ—ºï¸  Maps of Content (MOC) Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What would you like to do?"
  echo ""
  echo "  1) Create a new MOC"
  echo "  2) List all MOCs"
  echo "  3) View a MOC"
  echo "  4) Add note to MOC"
  echo "  5) Auto-populate MOC from tags"
  echo ""
  echo -n "Choose: "
  read moc_choice
  
  case "$moc_choice" in
    1)
      echo ""
      echo -n "MOC topic: "
      read topic
      echo -n "Description (optional): "
      read desc
      gtd-brain-moc create "$topic" "$desc"
      ;;
    2)
      gtd-brain-moc list
      ;;
    3)
      echo ""
      gtd-brain-moc list
      echo ""
      echo -n "MOC topic to view (or number/partial name): "
      read topic
      if [[ -n "$topic" ]]; then
        gtd-brain-moc view "$topic"
      fi
      ;;
    4)
      echo ""
      gtd-brain-moc list
      echo ""
      echo -n "MOC topic: "
      read topic
      echo -n "Note path: "
      read note_path
      echo -n "Category (Projects/Areas/Resources/Archives): "
      read category
      gtd-brain-moc add "$topic" "$note_path" "${category:-Resources}"
      ;;
    5)
      echo ""
      gtd-brain-moc list
      echo ""
      echo -n "MOC topic: "
      read topic
      echo -n "Tag to search for (optional, uses topic if empty): "
      read tag
      gtd-brain-moc auto "$topic" "$tag"
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Express wizard
express_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}âœï¸  Express Phase Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What would you like to do?"
  echo ""
  echo "  1) Create content from notes"
  echo "  2) List drafts"
  echo "  3) Publish a draft"
  echo "  4) List published content"
  echo "  5) Create an idea"
  echo ""
  echo -n "Choose: "
  read express_choice
  
  case "$express_choice" in
    1)
      echo ""
      echo -n "Content title: "
      read title
      echo -n "Source notes (comma-separated paths): "
      read notes
      echo -n "Content type (article/blog/presentation/report): "
      read type
      gtd-brain-express create "$title" "$notes" "${type:-article}"
      ;;
    2)
      gtd-brain-express drafts
      ;;
    3)
      echo ""
      gtd-brain-express drafts
      echo ""
      echo -n "Draft path to publish: "
      read draft
      gtd-brain-express publish "$draft"
      ;;
    4)
      gtd-brain-express published
      ;;
    5)
      echo ""
      echo -n "Idea description: "
      read idea
      gtd-brain-express idea "$idea"
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Template wizard
template_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ“‹ Template Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What would you like to do?"
  echo ""
  echo "  1) List available templates"
  echo "  2) Create note from template"
  echo ""
  echo -n "Choose: "
  read template_choice
  
  case "$template_choice" in
    1)
      gtd-brain-template list
      ;;
    2)
      echo ""
      gtd-brain-template list
      echo ""
      echo -n "Template name: "
      read template
      echo -n "Output note name: "
      read name
      echo -n "Category (Projects/Areas/Resources): "
      read category
      gtd-brain-template create "$template" "$name" "${category:-Resources}"
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Second Brain learning wizard
learn_second_brain_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ§  Second Brain Learning - Where to Start${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "Welcome to your Second Brain! Let's get you started."
  echo ""
  echo "What would you like to do?"
  echo ""
  echo "  1) ğŸ“š Learn Second Brain basics (with Mistress Louiza)"
  echo "  2) ğŸ¯ Quick start guide (step-by-step)"
  echo "  3) ğŸ“– Learn specific topic (interactive menu)"
  echo "  4) ğŸ”„ Sync your GTD with Second Brain"
  echo "  9) ğŸ“± Sync daily logs (for switching computers)"
  echo "  5) ğŸ“‹ Try a template"
  echo "  6) ğŸ—ºï¸  Create your first MOC"
  echo "  7) âœï¸  Try Express phase"
  echo "  8) ğŸ“Š Check your Second Brain status"
  echo ""
  echo -n "Choose: "
  read choice
  
  case "$choice" in
    1)
      clear
      echo ""
      echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo -e "${BOLD}${CYAN}ğŸ‘‘ Learning from Mistress Louiza${NC}"
      echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo ""
      gtd-learn second-brain
      ;;
    2)
      quick_start_second_brain
      ;;
    3)
      clear
      show_second_brain_topics
      ;;
    4)
      clear
      echo ""
      echo "ğŸ”„ Syncing GTD with Second Brain..."
      echo ""
      gtd-brain-sync
      echo ""
      echo "âœ“ Sync complete!"
      echo ""
      echo "Your GTD projects, areas, and references are now linked to Second Brain."
      echo ""
      echo "Press Enter to continue..."
      read
      ;;
    5)
      clear
      echo ""
      echo "ğŸ“‹ Let's try a template!"
      echo ""
      gtd-brain-template list
      echo ""
      echo "Which template would you like to try?"
      echo "  1) Meeting Notes"
      echo "  2) Book Notes"
      echo "  3) Article Notes"
      echo "  4) Project Notes"
      echo ""
      echo -n "Choose: "
      read template_choice
      
      case "$template_choice" in
        1) template_name="Meeting Notes" ;;
        2) template_name="Book Notes" ;;
        3) template_name="Article Notes" ;;
        4) template_name="Project Notes" ;;
        *) template_name="Meeting Notes" ;;
      esac
      
      echo ""
      echo -n "What should we call this note? "
      read note_name
      
      gtd-brain-template create "$template_name" "$note_name" Resources
      echo ""
      echo "âœ“ Created! Open it in Obsidian to fill it in."
      echo ""
      echo "Press Enter to continue..."
      read
      ;;
    6)
      clear
      echo ""
      echo "ğŸ—ºï¸  Let's create your first MOC!"
      echo ""
      echo "MOCs (Maps of Content) are index notes that organize related notes."
      echo ""
      echo "What would you like to do?"
      echo ""
      echo "  1) Create a custom MOC"
      echo "  2) Use starter MOC wizard (recommended)"
      echo ""
      echo -n "Choose: "
      read moc_choice
      
      case "$moc_choice" in
        1)
          echo ""
          echo -n "What topic would you like to create a MOC for? "
          read topic
          
          if [[ -n "$topic" ]]; then
            echo ""
            gtd-brain-moc create "$topic"
            echo ""
            echo "ğŸ’¡ Next steps:"
            echo "  â€¢ Add notes to this MOC: gtd-brain-moc add \"$topic\" <note-path>"
            echo "  â€¢ Auto-populate from tags: gtd-brain-moc auto \"$topic\" <tag>"
            echo "  â€¢ View the MOC: gtd-brain-moc view \"$topic\""
            echo ""
          fi
          ;;
        2)
          gtd-brain-moc-starter
          ;;
        *)
          echo "Invalid choice"
          ;;
      esac
      
      echo "Press Enter to continue..."
      read
      ;;
    7)
      clear
      echo ""
      echo "âœï¸  Express Phase - Create content from your notes!"
      echo ""
      echo "The Express phase is about creating and sharing from your Second Brain."
      echo ""
      echo "First, let's see what notes you have:"
      echo ""
      gtd-brain list Resources 2>/dev/null | head -20
      echo ""
      echo "To create content from notes:"
      echo "  gtd-brain-express create \"Title\" \"note1.md,note2.md\" article"
      echo ""
      echo "Or use the Express wizard from the main menu (option 9)."
      echo ""
      echo "Press Enter to continue..."
      read
      ;;
    8)
      clear
      echo ""
      echo "ğŸ“Š Your Second Brain Status"
      echo ""
      gtd-brain-metrics dashboard 2>/dev/null || echo "Run: gtd-brain-metrics dashboard"
      echo ""
      echo "Press Enter to continue..."
      read
      ;;
    9)
      clear
      echo ""
      echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo -e "${BOLD}${CYAN}ğŸ“± Daily Log Sync${NC}"
      echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo ""
      echo "Sync your daily logs for switching computers."
      echo ""
      echo "What would you like to do?"
      echo ""
      echo "  1) ğŸ”„ Two-way sync (recommended)"
      echo "  2) ğŸ“¤ Push to Second Brain (before switching computers)"
      echo "  3) ğŸ“¥ Pull from Second Brain (after switching computers)"
      echo "  4) ğŸ“Š Check sync status"
      echo ""
      echo -n "Choose: "
      read sync_choice
      
      case "$sync_choice" in
        1)
          gtd-daily-log-sync sync
          echo ""
          echo "Press Enter to continue..."
          read
          ;;
        2)
          gtd-daily-log-sync push
          echo ""
          echo "Press Enter to continue..."
          read
          ;;
        3)
          gtd-daily-log-sync pull
          echo ""
          echo "Press Enter to continue..."
          read
          ;;
        4)
          gtd-daily-log-sync status
          echo ""
          echo "Press Enter to continue..."
          read
          ;;
        *)
          echo "Invalid choice"
          ;;
      esac
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
}

# Quick start guide
quick_start_second_brain() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸš€ Second Brain Quick Start Guide${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "Let's get you started with Second Brain in 5 steps!"
  echo ""
  
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "Step 1: Sync Your GTD"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  echo "Your GTD system can automatically sync with Second Brain."
  echo ""
  read -p "Sync now? (y/n) " sync_now
  if [[ "$sync_now" == "y" || "$sync_now" == "Y" ]]; then
    echo ""
    gtd-brain-sync
    echo ""
  fi
  echo ""
  echo "Press Enter to continue..."
  read
  
  clear
  echo ""
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "Step 2: Create Your First Note"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  echo "Let's create a note in your Second Brain."
  echo ""
  echo -n "What would you like to create a note about? "
  read note_topic
  
  if [[ -n "$note_topic" ]]; then
    echo ""
    gtd-brain create "$note_topic" Resources
    echo ""
    echo "âœ“ Created! This note is in: ~/Documents/obsidian/Second Brain/Resources/"
    echo ""
  fi
  echo ""
  echo "Press Enter to continue..."
  read
  
  clear
  echo ""
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "Step 3: Try a Template"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  echo "Templates help you create structured notes quickly."
  echo ""
  gtd-brain-template list 2>/dev/null || echo "Templates available: Meeting Notes, Book Notes, Article Notes, Project Notes"
  echo ""
  echo -n "Would you like to try a template? (y/n) "
  read try_template
  
  if [[ "$try_template" == "y" || "$try_template" == "Y" ]]; then
    echo ""
    echo -n "Which template? (Meeting Notes/Book Notes/Article Notes): "
    read template_name
    echo -n "What should we call it? "
    read template_note_name
    
    if [[ -n "$template_name" && -n "$template_note_name" ]]; then
      gtd-brain-template create "$template_name" "$template_note_name" Resources
    fi
  fi
  echo ""
  echo "Press Enter to continue..."
  read
  
  clear
  echo ""
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "Step 4: Create Your First MOC"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  echo "MOCs (Maps of Content) organize related notes by topic."
  echo ""
  echo -n "What topic would you like to create a MOC for? "
  read moc_topic
  
  if [[ -n "$moc_topic" ]]; then
    echo ""
    gtd-brain-moc create "$moc_topic"
    echo ""
    echo "ğŸ’¡ You can add notes to this MOC later:"
    echo "   gtd-brain-moc add \"$moc_topic\" <note-path>"
    echo ""
  fi
  echo ""
  echo "Press Enter to continue..."
  read
  
  clear
  echo ""
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo "Step 5: Learn More"
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  echo "You're ready to start using your Second Brain!"
  echo ""
  echo "ğŸ“š Next steps:"
  echo "  â€¢ Learn more: gtd-learn second-brain"
  echo "  â€¢ Check quality: gtd-brain-metrics dashboard"
  echo "  â€¢ Explore commands: gtd-brain --help"
  echo "  â€¢ Read docs: ~/code/dotfiles/zsh/SECOND_BRAIN_INTEGRATION.md"
  echo ""
  echo "ğŸ¯ Key Commands:"
  echo "  â€¢ gtd-brain create \"Note\" - Create a note"
  echo "  â€¢ gtd-brain-sync - Sync GTD with Second Brain"
  echo "  â€¢ gtd-brain-moc create \"Topic\" - Create a MOC"
  echo "  â€¢ gtd-brain-template create \"Template\" \"Name\" - Use a template"
  echo "  â€¢ gtd-brain-distill <note> - Progressive summarization"
  echo ""
  echo "Press Enter to continue..."
  read
}

# Show Second Brain topics menu
show_second_brain_topics() {
  while true; do
    clear
    echo ""
    echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "${BOLD}${CYAN}ğŸ“š Second Brain Topics${NC}"
    echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo ""
    echo "What would you like to learn about?"
    echo ""
    echo "  1) CODE Method (Capture, Organize, Distill, Express)"
    echo "  2) PARA Method (Projects, Areas, Resources, Archives)"
    echo "  3) Progressive Summarization"
    echo "  4) MOCs (Maps of Content)"
    echo "  5) Express Phase"
    echo "  6) Templates"
    echo "  7) Intermediate Packets"
    echo "  8) Evergreen Notes"
    echo "  9) Divergence/Convergence"
    echo "  10) Connection Notes"
    echo "  11) Quality Metrics"
    echo "  12) Archive Strategy"
    echo ""
    echo -e "${YELLOW}0)${NC} Back to main menu"
    echo ""
    echo -n "Choose: "
    read topic_choice
    
    case "$topic_choice" in
      1)
        clear
        echo ""
        echo "ğŸ“š CODE Method"
        echo ""
        echo "CODE stands for:"
        echo "  â€¢ Capture - gtd-capture"
        echo "  â€¢ Organize - PARA method"
        echo "  â€¢ Distill - Progressive summarization"
        echo "  â€¢ Express - Create content from notes"
        echo ""
        echo "Learn more: gtd-learn second-brain"
        echo ""
        echo "Press Enter to continue..."
        read
        ;;
      2)
        clear
        echo ""
        echo "ğŸ“ PARA Method"
        echo ""
        echo "Organize notes into:"
        echo "  â€¢ Projects - Active projects"
        echo "  â€¢ Areas - Ongoing responsibilities"
        echo "  â€¢ Resources - Reference materials"
        echo "  â€¢ Archives - Completed/inactive items"
        echo ""
        echo "Your Second Brain uses this structure automatically!"
        echo ""
        echo "Press Enter to continue..."
        read
        ;;
      3)
        clear
        echo ""
        echo "ğŸ”¬ Progressive Summarization"
        echo ""
        echo "Three levels of distillation:"
        echo "  â€¢ Level 1: Highlight key points"
        echo "  â€¢ Level 2: Create summary"
        echo "  â€¢ Level 3: Distill to core insights"
        echo ""
        echo "Try it: gtd-brain-distill <note-path>"
        echo ""
        echo "Press Enter to continue..."
        read
        ;;
      4)
        clear
        echo ""
        echo "ğŸ—ºï¸  MOCs (Maps of Content)"
        echo ""
        echo "Index notes that organize related notes by topic."
        echo ""
        echo "Commands:"
        echo "  â€¢ gtd-brain-moc create \"Topic\""
        echo "  â€¢ gtd-brain-moc add \"Topic\" <note>"
        echo "  â€¢ gtd-brain-moc auto \"Topic\" <tag>"
        echo ""
        echo "Press Enter to continue..."
        read
        ;;
      5)
        clear
        echo ""
        echo "âœï¸  Express Phase"
        echo ""
        echo "Create and share content from your notes."
        echo ""
        echo "Commands:"
        echo "  â€¢ gtd-brain-express create \"Title\" \"notes\" article"
        echo "  â€¢ gtd-brain-express drafts"
        echo "  â€¢ gtd-brain-express publish <draft>"
        echo ""
        echo "Press Enter to continue..."
        read
        ;;
      6)
        clear
        echo ""
        echo "ğŸ“‹ Templates"
        echo ""
        echo "Structured templates for different note types."
        echo ""
        echo "Available:"
        echo "  â€¢ Meeting Notes"
        echo "  â€¢ Book Notes"
        echo "  â€¢ Article Notes"
        echo "  â€¢ Project Notes"
        echo "  â€¢ Area Notes"
        echo ""
        echo "Try: gtd-brain-template list"
        echo ""
        echo "Press Enter to continue..."
        read
        ;;
      7)
        clear
        echo ""
        echo "ğŸ“¦ Intermediate Packets"
        echo ""
        echo "Reusable components you can assemble into projects."
        echo ""
        echo "Commands:"
        echo "  â€¢ gtd-brain-packet create <note> <name>"
        echo "  â€¢ gtd-brain-packet use <name>"
        echo "  â€¢ gtd-brain-packet assemble <name> <packets...>"
        echo ""
        echo "Press Enter to continue..."
        read
        ;;
      8)
        clear
        echo ""
        echo "ğŸŒ² Evergreen Notes"
        echo ""
        echo "Notes that grow in value through continuous refinement."
        echo ""
        echo "Commands:"
        echo "  â€¢ gtd-brain-evergreen mark <note>"
        echo "  â€¢ gtd-brain-evergreen refine <note>"
        echo "  â€¢ gtd-brain-evergreen list"
        echo ""
        echo "Press Enter to continue..."
        read
        ;;
      9)
        clear
        echo ""
        echo "ğŸ’¡ Divergence/Convergence"
        echo ""
        echo "Two-phase thinking:"
        echo "  â€¢ Divergence: Generate many ideas (brainstorming)"
        echo "  â€¢ Convergence: Narrow down to best ideas (decisions)"
        echo ""
        echo "Commands:"
        echo "  â€¢ gtd-brain-diverge \"Topic\""
        echo "  â€¢ gtd-brain-converge <divergence-file>"
        echo ""
        echo "Press Enter to continue..."
        read
        ;;
      10)
        clear
        echo ""
        echo "ğŸ”— Connection Notes"
        echo ""
        echo "Explicit notes that connect ideas across topics."
        echo ""
        echo "Commands:"
        echo "  â€¢ gtd-brain-connect create <note1> <note2>"
        echo "  â€¢ gtd-brain-connect detect <note>"
        echo "  â€¢ gtd-brain-connect list"
        echo ""
        echo "Press Enter to continue..."
        read
        ;;
      11)
        clear
        echo ""
        echo "ğŸ“Š Quality Metrics"
        echo ""
        echo "Track and improve note quality over time."
        echo ""
        echo "Commands:"
        echo "  â€¢ gtd-brain-metrics <note>"
        echo "  â€¢ gtd-brain-metrics dashboard"
        echo ""
        echo "Press Enter to continue..."
        read
        ;;
      12)
        clear
        echo ""
        echo "ğŸ“¦ Archive Strategy"
        echo ""
        echo "Better system for archiving and retrieving notes."
        echo ""
        echo "Commands:"
        echo "  â€¢ gtd-brain archive <note> [reason]"
        echo "  â€¢ gtd-brain archive-review"
        echo ""
        echo "Press Enter to continue..."
        read
        ;;
      0)
        return
        ;;
      *)
        echo "Invalid choice"
        sleep 1
        ;;
    esac
  done
}

# Life vision discovery wizard
life_vision_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ¯ Life Vision Discovery${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "Not everyone has a clear life planâ€”and that's okay!"
  echo "This wizard helps you discover what matters to you."
  echo ""
  echo "What would you like to do?"
  echo ""
  echo "  1) ğŸ“– Read the Life Vision Discovery Guide"
  echo "  2) ğŸ” Review what you're already doing (discover patterns)"
  echo "  3) ğŸ’­ Answer discovery questions"
  echo "  4) ğŸ“ Create a simple life vision document"
  echo "  5) ğŸ¯ Review your areas (what matters to you)"
  echo "  6) ğŸ“Š Review your projects (what you're building)"
  echo "  7) ğŸ“… Review your daily logs (patterns in your life)"
  echo ""
  echo -e "${YELLOW}0)${NC} Back to main menu"
  echo ""
  echo -n "Choose: "
  read choice
  
  case "$choice" in
    1)
      if [[ -f "$HOME/code/dotfiles/zsh/LIFE_VISION_DISCOVERY_GUIDE.md" ]]; then
        if command -v less &>/dev/null; then
          less "$HOME/code/dotfiles/zsh/LIFE_VISION_DISCOVERY_GUIDE.md"
        elif command -v cat &>/dev/null; then
          cat "$HOME/code/dotfiles/zsh/LIFE_VISION_DISCOVERY_GUIDE.md"
        else
          echo "Guide: $HOME/code/dotfiles/zsh/LIFE_VISION_DISCOVERY_GUIDE.md"
        fi
      else
        echo "Guide not found. Creating it now..."
        echo "See: zsh/LIFE_VISION_DISCOVERY_GUIDE.md"
      fi
      read -p "Press Enter to continue..."
      life_vision_wizard
      ;;
    2)
      echo ""
      echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
      echo "ğŸ” Reviewing What You're Already Doing"
      echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
      echo ""
      echo "Let's look at your GTD system to discover patterns..."
      echo ""
      echo "ğŸ“ Your Areas of Responsibility:"
      gtd-area list 2>/dev/null || echo "  (No areas yet)"
      echo ""
      echo "ğŸ“ Your Active Projects:"
      gtd-project list 2>/dev/null || echo "  (No projects yet)"
      echo ""
      echo "ğŸ“Š Your Habits:"
      gtd-habit dashboard 2>/dev/null || echo "  (No habits yet)"
      echo ""
      echo "ğŸ’¡ Questions to consider:"
      echo "  - What areas are you investing time in?"
      echo "  - What projects are you building?"
      echo "  - What patterns do you see?"
      echo "  - What matters to you based on what you're doing?"
      echo ""
      read -p "Press Enter to continue..."
      life_vision_wizard
      ;;
    3)
      echo ""
      echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
      echo "ğŸ’­ Discovery Questions"
      echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
      echo ""
      echo "Answer these questions honestly (it's okay if you don't know!):"
      echo ""
      echo "1. What makes you feel good?"
      read -p "   " q1
      echo ""
      echo "2. What would you change if you could?"
      read -p "   " q2
      echo ""
      echo "3. What are you curious about?"
      read -p "   " q3
      echo ""
      echo "4. What would you do if you weren't afraid?"
      read -p "   " q4
      echo ""
      echo "5. What would you do if money wasn't a concern?"
      read -p "   " q5
      echo ""
      echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
      echo "ğŸ’¡ Your Answers"
      echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
      echo ""
      echo "1. What makes you feel good: $q1"
      echo "2. What would you change: $q2"
      echo "3. What are you curious about: $q3"
      echo "4. What would you do if you weren't afraid: $q4"
      echo "5. What would you do if money wasn't a concern: $q5"
      echo ""
      echo "ğŸ’¡ Look for patterns in your answers. What themes emerge?"
      echo ""
      read -p "Save these answers? (y/n) " -n 1 -r
      echo
      if [[ $REPLY =~ ^[Yy]$ ]]; then
        local vision_file="$HOME/Documents/gtd/life-vision.md"
        mkdir -p "$HOME/Documents/gtd"
        if [[ ! -f "$vision_file" ]]; then
          cat > "$vision_file" <<EOF
# My Life Vision

Created: $(date +"%Y-%m-%d")

## Discovery Questions

1. What makes you feel good?
   $q1

2. What would you change if you could?
   $q2

3. What are you curious about?
   $q3

4. What would you do if you weren't afraid?
   $q4

5. What would you do if money wasn't a concern?
   $q5

## Notes
[Add your thoughts here]

EOF
        else
          cat >> "$vision_file" <<EOF

## Discovery Session - $(date +"%Y-%m-%d")

1. What makes you feel good?
   $q1

2. What would you change if you could?
   $q2

3. What are you curious about?
   $q3

4. What would you do if you weren't afraid?
   $q4

5. What would you do if money wasn't a concern?
   $q5

EOF
        fi
        echo "âœ“ Saved to: $vision_file"
      fi
      read -p "Press Enter to continue..."
      life_vision_wizard
      ;;
    4)
      echo ""
      echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
      echo "ğŸ“ Create Life Vision Document"
      echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
      echo ""
      local vision_file="$HOME/Documents/gtd/life-vision.md"
      mkdir -p "$HOME/Documents/gtd"
      
      if [[ -f "$vision_file" ]]; then
        echo "Life vision document already exists: $vision_file"
        read -p "Open it? (y/n) " -n 1 -r
        echo
        if [[ $REPLY =~ ^[Yy]$ ]]; then
          if command -v open &>/dev/null; then
            open "$vision_file"
          elif command -v less &>/dev/null; then
            less "$vision_file"
          else
            cat "$vision_file"
          fi
        fi
      else
        echo "Creating life vision document..."
        echo ""
        echo "1-Year Vision (even if vague):"
        read -p "   " vision_1yr
        echo ""
        echo "3-5 Values that matter to you:"
        read -p "   Value 1: " value1
        read -p "   Value 2: " value2
        read -p "   Value 3: " value3
        echo ""
        echo "3 Areas to focus on:"
        read -p "   Area 1: " area1
        read -p "   Area 2: " area2
        read -p "   Area 3: " area3
        
        cat > "$vision_file" <<EOF
# My Life Vision

Created: $(date +"%Y-%m-%d")
Last Updated: $(date +"%Y-%m-%d")

## 1-Year Vision
${vision_1yr:-Not sure yet - using reviews to discover}

## Values (What Matters to Me)
1. ${value1:-}
2. ${value2:-}
3. ${value3:-}

## Areas of Focus
1. ${area1:-}
2. ${area2:-}
3. ${area3:-}

## Notes
[Add your thoughts, questions, and discoveries here]

## Discovery Process
- Review this document monthly
- Update quarterly
- Refine yearly
- It's okay if it changes!

EOF
        echo ""
        echo "âœ“ Created: $vision_file"
        echo ""
        echo "ğŸ’¡ Tip: Review and update this document regularly."
        echo "   Your vision will emerge as you use your GTD system."
      fi
      read -p "Press Enter to continue..."
      life_vision_wizard
      ;;
    5)
      echo ""
      echo "Reviewing your areas to see what matters to you..."
      gtd-area list
      echo ""
      read -p "Press Enter to continue..."
      life_vision_wizard
      ;;
    6)
      echo ""
      echo "Reviewing your projects to see what you're building..."
      gtd-project list
      echo ""
      read -p "Press Enter to continue..."
      life_vision_wizard
      ;;
    7)
      echo ""
      echo "Reviewing your daily logs to discover patterns..."
      gtd-log view
      echo ""
      read -p "Press Enter to continue..."
      life_vision_wizard
      ;;
    0)
      show_main_menu
      ;;
    *)
      echo "Invalid choice"
      sleep 1
      life_vision_wizard
      ;;
  esac
}

# Diagram wizard
diagram_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ¨ Diagram & Mindmap Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What would you like to create?"
  echo ""
  echo "  1) ğŸ—ºï¸  Mindmap (brainstorming, organizing thoughts)"
  echo "  2) ğŸ”„ Flowchart (processes, workflows)"
  echo "  3) ğŸ“Š Sequence diagram (interactions, sequences)"
  echo "  4) ğŸ“… Gantt chart (timelines, scheduling)"
  echo "  5) ğŸ”€ State diagram (state transitions, lifecycles)"
  echo "  6) ğŸ—„ï¸  Entity-relationship diagram (data relationships)"
  echo "  7) ğŸ“‹ Other diagram type"
  echo "  8) ğŸ“ List all diagrams"
  echo "  9) ğŸ‘ï¸  View a diagram"
  echo "  10) ğŸ’¾ Save diagram to Second Brain"
  echo ""
  echo -n "Choose: "
  read diagram_choice
  
  case "$diagram_choice" in
    1)
      echo ""
      echo -n "Mindmap topic: "
      read topic
      if [[ -n "$topic" ]]; then
        gtd-diagram mindmap "$topic"
      else
        echo "âŒ Topic required"
      fi
      ;;
    2)
      echo ""
      echo -n "Process/flowchart description: "
      read process
      if [[ -n "$process" ]]; then
        gtd-diagram flowchart "$process"
      else
        echo "âŒ Description required"
      fi
      ;;
    3)
      echo ""
      echo -n "Sequence diagram description: "
      read desc
      if [[ -n "$desc" ]]; then
        gtd-diagram create sequence "$desc"
      else
        echo "âŒ Description required"
      fi
      ;;
    4)
      echo ""
      echo -n "Gantt chart description: "
      read desc
      if [[ -n "$desc" ]]; then
        gtd-diagram create gantt "$desc"
      else
        echo "âŒ Description required"
      fi
      ;;
    5)
      echo ""
      echo -n "State diagram description: "
      read desc
      if [[ -n "$desc" ]]; then
        gtd-diagram create state "$desc"
      else
        echo "âŒ Description required"
      fi
      ;;
    6)
      echo ""
      echo -n "ER diagram description: "
      read desc
      if [[ -n "$desc" ]]; then
        gtd-diagram create er "$desc"
      else
        echo "âŒ Description required"
      fi
      ;;
    7)
      echo ""
      echo "Available types: class, journey, gitgraph, pie, requirement"
      echo -n "Diagram type: "
      read type
      echo -n "Description: "
      read desc
      if [[ -n "$type" && -n "$desc" ]]; then
        gtd-diagram create "$type" "$desc"
      else
        echo "âŒ Type and description required"
      fi
      ;;
    8)
      gtd-diagram list
      ;;
    9)
      echo ""
      gtd-diagram list
      echo ""
      echo -n "Diagram name to view: "
      read name
      if [[ -n "$name" ]]; then
        gtd-diagram view "$name"
      fi
      ;;
    10)
      echo ""
      gtd-diagram list
      echo ""
      echo -n "Diagram filename to save: "
      read filename
      if [[ -n "$filename" ]]; then
        gtd-diagram save "$filename"
      fi
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Check-in wizard
checkin_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸŒ…ğŸŒ™ Morning/Evening Check-In${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What type of check-in?"
  echo ""
  echo "  1) ğŸŒ… Morning Check-In"
  echo "  2) ğŸŒ™ Evening Check-In"
  echo ""
  echo -n "Choose: "
  read checkin_choice
  
  case "$checkin_choice" in
    1)
      gtd-checkin morning
      ;;
    2)
      gtd-checkin evening
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Quick complete habits - show all due habits and let user check them off
quick_complete_habits() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}âœ… Quick Complete Habits${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  
  # Load config to get HABITS_PATH
  GTD_CONFIG_FILE="$HOME/.gtd_config"
  if [[ -f "$HOME/code/dotfiles/zsh/.gtd_config" ]]; then
    GTD_CONFIG_FILE="$HOME/code/dotfiles/zsh/.gtd_config"
  elif [[ -f "$HOME/code/personal/dotfiles/zsh/.gtd_config" ]]; then
    GTD_CONFIG_FILE="$HOME/code/personal/dotfiles/zsh/.gtd_config"
  fi
  
  if [[ -f "$GTD_CONFIG_FILE" ]]; then
    source "$GTD_CONFIG_FILE"
  fi
  
  GTD_BASE_DIR="${GTD_BASE_DIR:-$HOME/Documents/gtd}"
  HABITS_PATH="${GTD_BASE_DIR}/habits"
  
  # Get date command
  get_date_cmd() {
    if [[ -x "/usr/bin/date" ]]; then
      echo "/usr/bin/date"
    elif [[ -x "/bin/date" ]]; then
      echo "/bin/date"
    else
      echo "date"
    fi
  }
  
  DATE_CMD=$(get_date_cmd)
  TODAY=$($DATE_CMD +"%Y-%m-%d")
  
  if [[ ! -d "$HABITS_PATH" ]]; then
    echo "No habits directory found. Create habits first."
    echo ""
    return
  fi
  
  # Find all active habits
  local habits=()
  local habit_names=()
  local habit_index=1
  
  for habit_file in "$HABITS_PATH"/*.md; do
    [[ ! -f "$habit_file" ]] && continue
    
    local status=$(grep "^status:" "$habit_file" 2>/dev/null | cut -d':' -f2 | sed 's/^[[:space:]]*//' || echo "active")
    if [[ "$status" != "active" ]]; then
      continue
    fi
    
    local habit_name=$(grep "^name:" "$habit_file" 2>/dev/null | cut -d':' -f2 | sed 's/^[[:space:]]*//' || basename "$habit_file" .md)
    local frequency=$(grep "^frequency:" "$habit_file" 2>/dev/null | cut -d':' -f2 | sed 's/^[[:space:]]*//' || echo "")
    local last_completed=$(grep "^last_completed:" "$habit_file" 2>/dev/null | cut -d':' -f2 | sed 's/^[[:space:]]*//' || echo "")
    local streak=$(grep "^streak:" "$habit_file" 2>/dev/null | cut -d':' -f2 | sed 's/^[[:space:]]*//' || echo "0")
    
    # Check if due
    local is_due=false
    if [[ "$frequency" == "daily" && "$last_completed" != "$TODAY" ]]; then
      is_due=true
    elif [[ "$frequency" == "weekly" ]]; then
      # Check if it's been a week
      if [[ -n "$last_completed" && "$last_completed" != "Never" ]]; then
        local days_since=$(( ($($DATE_CMD +%s) - $($DATE_CMD -j -f "%Y-%m-%d" "$last_completed" +%s 2>/dev/null || echo 0)) / 86400 ))
        if [[ $days_since -ge 7 ]]; then
          is_due=true
        fi
      else
        is_due=true
      fi
    elif [[ "$frequency" == "monthly" ]]; then
      # Check if it's been a month
      if [[ -n "$last_completed" && "$last_completed" != "Never" ]]; then
        local days_since=$(( ($($DATE_CMD +%s) - $($DATE_CMD -j -f "%Y-%m-%d" "$last_completed" +%s 2>/dev/null || echo 0)) / 86400 ))
        if [[ $days_since -ge 30 ]]; then
          is_due=true
        fi
      else
        is_due=true
      fi
    elif [[ -z "$last_completed" || "$last_completed" == "Never" ]]; then
      is_due=true
    fi
    
    if [[ "$is_due" == "true" ]]; then
      habits+=("$habit_file")
      habit_names+=("$habit_name")
      
      # Show habit with status
      local status_icon="â­•"
      if [[ "$last_completed" == "$TODAY" ]]; then
        status_icon="âœ…"
      fi
      
      echo -e "  ${GREEN}${habit_index})${NC} ${status_icon} ${BOLD}${habit_name}${NC}"
      echo "     Frequency: ${frequency} | Streak: ${streak} days"
      if [[ "$last_completed" != "$TODAY" && -n "$last_completed" && "$last_completed" != "Never" ]]; then
        echo "     Last completed: ${last_completed}"
      fi
      echo ""
      
      ((habit_index++))
    fi
  done
  
  if [[ ${#habits[@]} -eq 0 ]]; then
    echo "ğŸ‰ No habits due today! All caught up."
    echo ""
    return
  fi
  
  echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
  echo ""
  echo "Which habits did you complete? (Enter numbers separated by spaces, or 'all' for all, or 'none' to skip)"
  echo ""
  read -p "Your choice: " selected
  
  if [[ "$selected" == "all" || "$selected" == "ALL" ]]; then
    echo ""
    echo "Completing all habits..."
    for habit_name in "${habit_names[@]}"; do
      echo -n "  Completing '${habit_name}'... "
      gtd-habit log "$habit_name" >/dev/null 2>&1
      if [[ $? -eq 0 ]]; then
        echo -e "${GREEN}âœ“${NC}"
      else
        echo -e "${RED}âœ—${NC}"
      fi
    done
    echo ""
    echo -e "${GREEN}âœ“ All habits completed!${NC}"
  elif [[ "$selected" == "none" || "$selected" == "NONE" || -z "$selected" ]]; then
    echo ""
    echo "Skipping habit completion."
  else
    echo ""
    echo "Completing selected habits..."
    for num in $selected; do
      if [[ "$num" =~ ^[0-9]+$ ]] && [[ $num -ge 1 ]] && [[ $num -le ${#habits[@]} ]]; then
        local idx=$((num - 1))
        local habit_name="${habit_names[$idx]}"
        echo -n "  Completing '${habit_name}'... "
        gtd-habit log "$habit_name" >/dev/null 2>&1
        if [[ $? -eq 0 ]]; then
          echo -e "${GREEN}âœ“${NC}"
        else
          echo -e "${RED}âœ—${NC}"
        fi
      fi
    done
    echo ""
    echo -e "${GREEN}âœ“ Selected habits completed!${NC}"
  fi
  
  echo ""
}

# Habit wizard
habit_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ” Habits & Recurring Tasks${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What would you like to do?"
  echo ""
  echo "  1) âœ… Quick Complete (check off due habits)"
  echo "  2) Create a new habit"
  echo "  3) Log habit completion (by name)"
  echo "  4) View habit dashboard"
  echo "  5) List all habits"
  echo "  6) View habit details"
  echo "  7) Archive a habit"
  echo ""
  echo -n "Choose: "
  read habit_choice
  
  case "$habit_choice" in
    1)
      quick_complete_habits
      ;;
    2)
      echo ""
      echo -n "Habit name: "
      read habit_name
      if [[ -n "$habit_name" ]]; then
        gtd-habit create "$habit_name"
      fi
      ;;
    3)
      echo ""
      gtd-habit list
      echo ""
      echo -n "Habit name to log: "
      read habit_name
      if [[ -n "$habit_name" ]]; then
        gtd-habit log "$habit_name"
      fi
      ;;
    4)
      gtd-habit dashboard
      ;;
    5)
      gtd-habit list
      ;;
    6)
      echo ""
      gtd-habit list
      echo ""
      echo -n "Habit name to view: "
      read habit_name
      if [[ -n "$habit_name" ]]; then
        gtd-habit view "$habit_name"
      fi
      ;;
    7)
      echo ""
      gtd-habit list
      echo ""
      echo -n "Habit name to archive: "
      read habit_name
      if [[ -n "$habit_name" ]]; then
        gtd-habit archive "$habit_name"
      fi
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Kubernetes learning wizard
k8s_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}â˜¸ï¸  Kubernetes/CKA Learning Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What would you like to do?"
  echo ""
  echo "  1) Start learning (interactive menu)"
  echo "  2) Learn specific topic"
  echo "  3) Create study plan"
  echo "  4) View study progress"
  echo ""
  echo -n "Choose: "
  read k8s_choice
  
  case "$k8s_choice" in
    1)
      gtd-learn-kubernetes
      ;;
    2)
      echo ""
      echo "Available topics:"
      echo "  basics, pods, deployments, services, configmaps, storage, networking, troubleshooting, cka-exam, practice"
      echo ""
      echo -n "Topic: "
      read topic
      gtd-learn-kubernetes "$topic"
      ;;
    3)
      gtd-study-plan cka
      ;;
    4)
      gtd-learn-kubernetes
      # This will show progress in the menu
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Zettelkasten wizard
zettelkasten_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ”— Zettelkasten (Atomic Notes) Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What would you like to do?"
  echo ""
  echo "  1) Create atomic note (inbox)"
  echo "  2) Create atomic note (Zettelkasten directory)"
  echo "  3) Create atomic note (Resources - PARA)"
  echo "  4) Create atomic note (Projects - PARA)"
  echo "  5) Create atomic note (Areas - PARA)"
  echo "  6) Link note to Second Brain/PARA"
  echo "  7) Link note to GTD item"
  echo "  8) Move note to PARA category"
  echo "  9) List notes in inbox"
  echo "  10) List notes in Zettelkasten directory"
  echo "  11) Process inbox (move to organized location)"
  echo ""
  echo -n "Choose: "
  read zet_choice
  
  case "$zet_choice" in
    1)
      echo ""
      echo -n "Note title: "
      read note_title
      if [[ -n "$note_title" ]]; then
        zet "$note_title"
      else
        echo "âŒ No title provided"
      fi
      ;;
    2)
      echo ""
      echo -n "Note title: "
      read note_title
      if [[ -n "$note_title" ]]; then
        zet -z "$note_title"
      else
        echo "âŒ No title provided"
      fi
      ;;
    3)
      echo ""
      echo -n "Note title: "
      read note_title
      if [[ -n "$note_title" ]]; then
        zet -r "$note_title"
      else
        echo "âŒ No title provided"
      fi
      ;;
    4)
      echo ""
      echo -n "Note title: "
      read note_title
      if [[ -n "$note_title" ]]; then
        zet -p "$note_title"
      else
        echo "âŒ No title provided"
      fi
      ;;
    5)
      echo ""
      echo -n "Note title: "
      read note_title
      if [[ -n "$note_title" ]]; then
        zet -a "$note_title"
      else
        echo "âŒ No title provided"
      fi
      ;;
    6)
      echo ""
      echo "Link Zettelkasten note to Second Brain"
      echo ""
      # Find notes in common locations
      local zet_inbox="${SECOND_BRAIN}/0-inbox"
      local zet_dir="${SECOND_BRAIN}/Zettelkasten"
      local zet_note_path=""
      
      # Try to find notes
      if [[ -d "$zet_inbox" ]] && [[ -n "$(find "$zet_inbox" -maxdepth 1 -name "*.md" -type f 2>/dev/null)" ]]; then
        echo "Available notes (inbox):"
        zet_note_path=$(select_from_list "note" "$zet_inbox" "name")
      elif [[ -d "$zet_dir" ]] && [[ -n "$(find "$zet_dir" -name "*.md" -type f 2>/dev/null | head -20)" ]]; then
        echo "Available notes (zettelkasten):"
        zet_note_path=$(select_from_list "note" "$zet_dir" "name")
      fi
      
      if [[ -z "$zet_note_path" ]]; then
        echo -n "Zettelkasten note path: "
        read zet_note
      else
        # Find the full path to the selected note
        zet_note=$(find "$zet_inbox" "$zet_dir" -name "${zet_note_path}.md" -o -name "*${zet_note_path}*.md" 2>/dev/null | head -1)
        if [[ -z "$zet_note" ]]; then
          zet_note="$zet_note_path"
        fi
      fi
      
      echo ""
      echo "Link to:"
      echo "  1) Projects (PARA)"
      echo "  2) Areas (PARA)"
      echo "  3) Resources (PARA)"
      echo "  4) Specific Second Brain note"
      echo ""
      echo -n "Choose: "
      read link_choice
      
      case "$link_choice" in
        1)
          zet-link link "$zet_note" Projects
          ;;
        2)
          zet-link link "$zet_note" Areas
          ;;
        3)
          zet-link link "$zet_note" Resources
          ;;
        4)
          echo -n "Second Brain note path: "
          read brain_note
          zet-link link "$zet_note" "$brain_note"
          ;;
        *)
          echo "Invalid choice"
          ;;
      esac
      ;;
    7)
      echo ""
      # Find notes in common locations
      local zet_inbox="${SECOND_BRAIN}/0-inbox"
      local zet_dir="${SECOND_BRAIN}/Zettelkasten"
      local zet_note_path=""
      
      if [[ -d "$zet_inbox" ]] && [[ -n "$(find "$zet_inbox" -maxdepth 1 -name "*.md" -type f 2>/dev/null)" ]]; then
        echo "Available notes (inbox):"
        zet_note_path=$(select_from_list "note" "$zet_inbox" "name")
      elif [[ -d "$zet_dir" ]] && [[ -n "$(find "$zet_dir" -name "*.md" -type f 2>/dev/null | head -20)" ]]; then
        echo "Available notes (zettelkasten):"
        zet_note_path=$(select_from_list "note" "$zet_dir" "name")
      fi
      
      if [[ -z "$zet_note_path" ]]; then
        echo -n "Zettelkasten note path: "
        read zet_note
      else
        zet_note=$(find "$zet_inbox" "$zet_dir" -name "${zet_note_path}.md" -o -name "*${zet_note_path}*.md" 2>/dev/null | head -1)
        if [[ -z "$zet_note" ]]; then
          zet_note="$zet_note_path"
        fi
      fi
      
      echo -n "GTD item path: "
      read gtd_item
      if [[ -n "$zet_note" && -n "$gtd_item" ]]; then
        zet-link gtd "$zet_note" "$gtd_item"
      else
        echo "âŒ Both paths required"
      fi
      ;;
    8)
      echo ""
      echo -n "Zettelkasten note path: "
      read zet_note
      echo ""
      echo "Move to:"
      echo "  1) Projects"
      echo "  2) Areas"
      echo "  3) Resources"
      echo "  4) Archives"
      echo ""
      echo -n "Choose: "
      read move_choice
      
      case "$move_choice" in
        1)
          zet-link move "$zet_note" Projects
          ;;
        2)
          zet-link move "$zet_note" Areas
          ;;
        3)
          zet-link move "$zet_note" Resources
          ;;
        4)
          zet-link move "$zet_note" Archives
          ;;
        *)
          echo "Invalid choice"
          ;;
      esac
      ;;
    9)
      echo ""
      echo "ğŸ“¥ Notes in inbox:"
      echo ""
      local inbox_dir="${SECOND_BRAIN:-$HOME/Documents/obsidian/Second Brain}/0-inbox"
      if [[ -d "$inbox_dir" ]]; then
        local count=$(ls -1 "$inbox_dir"/*.md 2>/dev/null | wc -l | tr -d ' ')
        if [[ $count -gt 0 ]]; then
          ls -1t "$inbox_dir"/*.md 2>/dev/null | head -10 | while read -r note; do
            local title=$(head -1 "$note" 2>/dev/null | sed 's/# //' | head -c 60)
            echo "  â†’ $(basename "$note")"
            echo "    $title"
          done
          echo ""
          echo "Total: $count note(s)"
        else
          echo "  (empty)"
        fi
      else
        echo "  Inbox directory not found"
      fi
      ;;
    10)
      echo ""
      echo "ğŸ”— Notes in Zettelkasten directory:"
      echo ""
      local zet_dir="${SECOND_BRAIN:-$HOME/Documents/obsidian/Second Brain}/Zettelkasten"
      if [[ -d "$zet_dir" ]]; then
        local count=$(ls -1 "$zet_dir"/*.md 2>/dev/null | wc -l | tr -d ' ')
        if [[ $count -gt 0 ]]; then
          ls -1t "$zet_dir"/*.md 2>/dev/null | head -10 | while read -r note; do
            local title=$(head -1 "$note" 2>/dev/null | sed 's/# //' | head -c 60)
            echo "  â†’ $(basename "$note")"
            echo "    $title"
          done
          echo ""
          echo "Total: $count note(s)"
        else
          echo "  (empty)"
        fi
      else
        echo "  Zettelkasten directory not found"
      fi
      ;;
    11)
      echo ""
      echo "ğŸ“‹ Process Zettelkasten inbox"
      echo ""
      local inbox_dir="${SECOND_BRAIN:-$HOME/Documents/obsidian/Second Brain}/0-inbox"
      if [[ ! -d "$inbox_dir" ]]; then
        echo "âŒ Inbox directory not found"
        echo ""
        echo "Press Enter to continue..."
        read
        return 1
      fi
      
      # Use mapfile to properly handle paths with spaces
      local notes=()
      while IFS= read -r -d '' note; do
        notes+=("$note")
      done < <(find "$inbox_dir" -maxdepth 1 -name "*.md" -type f -print0 2>/dev/null | sort -z -r)
      
      local count=${#notes[@]}
      
      if [[ $count -eq 0 ]]; then
        echo "âœ… Zettelkasten inbox is empty!"
        echo ""
        echo "Press Enter to continue..."
        read
        return 0
      fi
      
      echo "You have $count note(s) in Zettelkasten inbox."
      echo ""
      echo "Processing notes..."
      echo ""
      
      for note in "${notes[@]}"; do
        local note_name=$(basename "$note")
        local title=$(head -1 "$note" 2>/dev/null | sed 's/# //' | head -c 60)
        
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "ğŸ“ Note: $note_name"
        echo "   Title: $title"
        echo ""
        echo "What would you like to do?"
        echo ""
        echo "  1) Move to Zettelkasten directory"
        echo "  2) Move to Resources (PARA)"
        echo "  3) Move to Projects (PARA)"
        echo "  4) Move to Areas (PARA)"
        echo "  5) Keep in inbox"
        echo "  6) Skip (process next)"
        echo ""
        echo -n "Choose: "
        read process_choice
        
        case "$process_choice" in
          1)
            local zet_dir="${SECOND_BRAIN:-$HOME/Documents/obsidian/Second Brain}/Zettelkasten"
            mkdir -p "$zet_dir"
            mv "$note" "$zet_dir/"
            echo "âœ“ Moved to Zettelkasten directory"
            ;;
          2)
            zet-link move "${note}" Resources
            ;;
          3)
            zet-link move "${note}" Projects
            ;;
          4)
            zet-link move "${note}" Areas
            ;;
          5)
            echo "âœ“ Keeping in inbox"
            ;;
          6|"")
            echo "â†’ Skipping..."
            ;;
          *)
            echo "Invalid choice, skipping..."
            ;;
        esac
        echo ""
      done
      
      echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
      echo "âœ“ Processing complete!"
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# AI Suggestions & MCP Tools wizard
ai_suggestions_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸ¤– AI Suggestions & MCP Tools${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What would you like to do?"
  echo ""
  echo "  1) Get task suggestions from text"
  echo "  2) Review pending suggestions"
  echo "  3) Analyze recent daily logs"
  echo "  4) Generate banter for log entry"
  echo "  5) Trigger weekly review (background)"
  echo "  6) Analyze energy patterns (background)"
  echo "  7) Find connections (background)"
  echo "  8) Generate insights (background)"
  echo "  9) Check MCP System Status"
  echo "  10) ğŸš€ Deploy Worker to Kubernetes"
  echo ""
  echo -n "Choose: "
  read ai_choice
  
  case "$ai_choice" in
    1)
      clear
      echo ""
      echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo -e "${BOLD}${CYAN}ğŸ’¡ Get Task Suggestions from Text${NC}"
      echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo ""
      echo "Enter the text to analyze for task suggestions:"
      echo ""
      read -p "Text: " suggestion_text
      
      if [[ -z "$suggestion_text" ]]; then
        echo "âŒ No text provided"
        echo ""
        echo "Press Enter to continue..."
        read
        return 1
      fi
      
      echo ""
      echo "Analyzing text for task suggestions..."
      
      AUTO_SUGGEST_SCRIPT="$HOME/code/dotfiles/mcp/gtd_auto_suggest.py"
      if [[ ! -f "$AUTO_SUGGEST_SCRIPT" ]]; then
        AUTO_SUGGEST_SCRIPT="$HOME/code/personal/dotfiles/mcp/gtd_auto_suggest.py"
      fi
      
      if [[ -f "$AUTO_SUGGEST_SCRIPT" ]]; then
        result=$(python3 "$AUTO_SUGGEST_SCRIPT" entry "$suggestion_text" 2>&1)
        # Try to parse and display nicely
        if echo "$result" | python3 -c "import sys, json; json.load(sys.stdin)" 2>/dev/null; then
          # Valid JSON - display formatted
          echo ""
          echo "$result" | python3 -c "
import sys, json
data = json.load(sys.stdin)
if data.get('suggestion_count', 0) > 0:
    print('âœ… Found', data['suggestion_count'], 'suggestion(s):')
    print('')
    for i, sid in enumerate(data.get('suggestions', []), 1):
        print(f'{i}. Suggestion ID: {sid}')
    print('')
if data.get('banter'):
    print('ğŸ’¬', data['banter'])
    print('')
print('Use option 2 to review pending suggestions.')
" 2>/dev/null || echo "$result"
        else
          # Not valid JSON, just show the output
          echo "$result"
        fi
      else
        echo "âŒ Auto-suggest script not found: $AUTO_SUGGEST_SCRIPT"
        echo ""
        echo "Make sure MCP server is set up. See mcp/README.md for details."
      fi
      ;;
    2)
      clear
      echo ""
      echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo -e "${BOLD}${CYAN}ğŸ“‹ Pending Suggestions${NC}"
      echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo ""
      
      SUGGESTIONS_DIR="${GTD_BASE_DIR}/suggestions"
      if [[ ! -d "$SUGGESTIONS_DIR" ]]; then
        echo "No suggestions directory found. No pending suggestions."
        echo ""
        echo "Press Enter to continue..."
        read
        return 0
      fi
      
      pending_count=0
      suggestions=()
      
      for suggestion_file in "$SUGGESTIONS_DIR"/*.json; do
        if [[ -f "$suggestion_file" ]]; then
          status=$(grep -o '"status":\s*"[^"]*"' "$suggestion_file" | cut -d'"' -f4)
          if [[ "$status" == "pending" ]]; then
            suggestions+=("$suggestion_file")
            ((pending_count++))
          fi
        fi
      done
      
      if [[ $pending_count -eq 0 ]]; then
        echo "âœ… No pending suggestions!"
        echo ""
        echo "Press Enter to continue..."
        read
        return 0
      fi
      
      echo "You have $pending_count pending suggestion(s)."
      echo ""
      echo "Processing suggestions..."
      echo ""
      
      for suggestion_file in "${suggestions[@]}"; do
        suggestion_id=$(basename "$suggestion_file" .json)
        title=$(grep -o '"title":\s*"[^"]*"' "$suggestion_file" | cut -d'"' -f4)
        reason=$(grep -o '"reason":\s*"[^"]*"' "$suggestion_file" | cut -d'"' -f4)
        confidence=$(grep -o '"confidence":\s*[0-9.]*' "$suggestion_file" | cut -d':' -f2 | tr -d ' ')
        
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "ğŸ’¡ Suggestion: $title"
        echo "   Reason: $reason"
        echo "   Confidence: $confidence"
        echo ""
        echo "What would you like to do?"
        echo ""
        echo "  1) Create task from suggestion"
        echo "  2) Dismiss suggestion"
        echo "  3) Skip (view next)"
        echo ""
        echo -n "Choose: "
        read suggestion_choice
        
        case "$suggestion_choice" in
          1)
            # Create task using gtd-task
            echo ""
            echo "Creating task..."
            gtd-task add --non-interactive "$title" 2>&1
            if [[ $? -eq 0 ]]; then
              # Mark suggestion as accepted
              if command -v python3 &>/dev/null; then
                python3 -c "
import json
import sys
file = '$suggestion_file'
with open(file, 'r') as f:
    data = json.load(f)
data['status'] = 'accepted'
with open(file, 'w') as f:
    json.dump(data, f, indent=2)
" 2>/dev/null
              fi
              echo "âœ“ Task created from suggestion"
            else
              echo "âŒ Failed to create task"
            fi
            ;;
          2)
            # Mark as dismissed
            if command -v python3 &>/dev/null; then
              python3 -c "
import json
file = '$suggestion_file'
with open(file, 'r') as f:
    data = json.load(f)
data['status'] = 'dismissed'
with open(file, 'w') as f:
    json.dump(data, f, indent=2)
" 2>/dev/null
              echo "âœ“ Suggestion dismissed"
            fi
            ;;
          3|"")
            echo "â†’ Skipping..."
            ;;
          *)
            echo "Invalid choice, skipping..."
            ;;
        esac
        echo ""
      done
      ;;
    3)
      clear
      echo ""
      echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo -e "${BOLD}${CYAN}ğŸ“Š Analyze Recent Daily Logs${NC}"
      echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo ""
      read -p "How many days to analyze? (default: 1): " days
      days="${days:-1}"
      
      echo ""
      echo "Analyzing recent logs..."
      
      AUTO_SUGGEST_SCRIPT="$HOME/code/dotfiles/mcp/gtd_auto_suggest.py"
      if [[ ! -f "$AUTO_SUGGEST_SCRIPT" ]]; then
        AUTO_SUGGEST_SCRIPT="$HOME/code/personal/dotfiles/mcp/gtd_auto_suggest.py"
      fi
      
      if [[ -f "$AUTO_SUGGEST_SCRIPT" ]]; then
        result=$(python3 "$AUTO_SUGGEST_SCRIPT" analyze "$days" 2>&1)
        echo "$result"
      else
        echo "âŒ Auto-suggest script not found"
      fi
      ;;
    4)
      clear
      echo ""
      echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo -e "${BOLD}${CYAN}ğŸ’¬ Generate Banter for Log Entry${NC}"
      echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo ""
      read -p "Enter log entry: " log_entry
      
      if [[ -z "$log_entry" ]]; then
        echo "âŒ No entry provided"
        echo ""
        echo "Press Enter to continue..."
        read
        return 1
      fi
      
      echo ""
      echo "Generating banter..."
      
      AUTO_SUGGEST_SCRIPT="$HOME/code/dotfiles/mcp/gtd_auto_suggest.py"
      if [[ ! -f "$AUTO_SUGGEST_SCRIPT" ]]; then
        AUTO_SUGGEST_SCRIPT="$HOME/code/personal/dotfiles/mcp/gtd_auto_suggest.py"
      fi
      
      if [[ -f "$AUTO_SUGGEST_SCRIPT" ]]; then
        banter=$(python3 "$AUTO_SUGGEST_SCRIPT" banter "$log_entry" 2>&1)
        echo ""
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
        echo "ğŸ’¬ $banter"
        echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
      else
        echo "âŒ Auto-suggest script not found"
      fi
      ;;
    5)
      echo ""
      echo "Queuing weekly review for background processing..."
      echo "Results will be saved to ~/Documents/gtd/deep_analysis_results/"
      echo ""
      echo "Note: This requires the background worker to be running."
      echo ""
      echo "Press Enter to continue..."
      read
      ;;
    6|7|8)
      echo ""
      echo "Queuing analysis for background processing..."
      echo "Results will be saved to ~/Documents/gtd/deep_analysis_results/"
      echo ""
      echo "Note: This requires the background worker to be running."
      echo ""
      echo "Press Enter to continue..."
      read
      ;;
    9)
      clear
      # Run MCP status check
      STATUS_SCRIPT="$HOME/code/dotfiles/mcp/gtd_mcp_status.sh"
      if [[ ! -f "$STATUS_SCRIPT" ]]; then
        STATUS_SCRIPT="$HOME/code/personal/dotfiles/mcp/gtd_mcp_status.sh"
      fi
      
      if [[ -f "$STATUS_SCRIPT" ]]; then
        bash "$STATUS_SCRIPT"
      else
        echo ""
        echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
        echo -e "${BOLD}${CYAN}ğŸ” MCP System Status${NC}"
        echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
        echo ""
        echo "Status script not found at: $STATUS_SCRIPT"
        echo ""
        echo "Quick checks:"
        echo ""
        
        # Quick LM Studio check
        if curl -s "http://localhost:1234/v1/models" >/dev/null 2>&1; then
          echo -e "${GREEN}âœ… LM Studio: Running${NC}"
        else
          echo -e "${RED}âŒ LM Studio: Not running${NC}"
        fi
        
        # Quick worker check
        if pgrep -f "gtd_deep_analysis_worker.py" >/dev/null; then
          echo -e "${GREEN}âœ… Background Worker: Running${NC}"
        else
          echo -e "${CYAN}â„¹ï¸  Background Worker: Not running${NC}"
        fi
        
        # Quick suggestions check
        SUGGESTIONS_DIR="${GTD_BASE_DIR}/suggestions"
        if [[ -d "$SUGGESTIONS_DIR" ]]; then
          pending_count=$(find "$SUGGESTIONS_DIR" -name "*.json" -exec grep -l '"status":\s*"pending"' {} \; 2>/dev/null | wc -l | tr -d ' ')
          if [[ "$pending_count" -gt 0 ]]; then
            echo -e "${YELLOW}âš ï¸  Pending Suggestions: $pending_count${NC}"
          else
            echo -e "${GREEN}âœ… Pending Suggestions: None${NC}"
          fi
        fi
      fi
      ;;
    10)
      deployment_wizard
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Deployment wizard
deployment_wizard() {
  clear
  echo ""
  echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${BOLD}${CYAN}ğŸš€ Kubernetes Deployment Wizard${NC}"
  echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "What would you like to do?"
  echo ""
  echo "  1) Build Docker image"
  echo "  2) Deploy worker to Kubernetes"
  echo "  3) Update deployment (rebuild & redeploy)"
  echo "  4) Check deployment status"
  echo "  5) View worker logs"
  echo "  6) Remove deployment"
  echo ""
  echo -n "Choose: "
  read deploy_choice
  
  DEPLOY_SCRIPT="$HOME/code/dotfiles/mcp/deploy.sh"
  if [[ ! -f "$DEPLOY_SCRIPT" ]]; then
    DEPLOY_SCRIPT="$HOME/code/personal/dotfiles/mcp/deploy.sh"
  fi
  
  if [[ ! -f "$DEPLOY_SCRIPT" ]]; then
    echo ""
    echo "âŒ Deployment script not found: $DEPLOY_SCRIPT"
    echo ""
    echo "Make sure the MCP system is set up. See mcp/README.md for details."
    echo ""
    echo "Press Enter to continue..."
    read
    return 1
  fi
  
  case "$deploy_choice" in
    1)
      clear
      echo ""
      echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo -e "${BOLD}${CYAN}ğŸ³ Building Docker Image${NC}"
      echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo ""
      bash "$DEPLOY_SCRIPT" build
      ;;
    2)
      clear
      echo ""
      echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo -e "${BOLD}${CYAN}â˜¸ï¸  Deploying to Kubernetes${NC}"
      echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo ""
      bash "$DEPLOY_SCRIPT" deploy
      ;;
    3)
      clear
      echo ""
      echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo -e "${BOLD}${CYAN}ğŸ”„ Updating Deployment${NC}"
      echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo ""
      bash "$DEPLOY_SCRIPT" update
      ;;
    4)
      clear
      bash "$DEPLOY_SCRIPT" status
      ;;
    5)
      clear
      bash "$DEPLOY_SCRIPT" logs
      ;;
    6)
      clear
      echo ""
      echo -e "${BOLD}${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo -e "${BOLD}${CYAN}ğŸ—‘ï¸  Removing Deployment${NC}"
      echo -e "${CYAN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
      echo ""
      echo "âš ï¸  This will remove the worker deployment from Kubernetes."
      echo ""
      echo -n "Are you sure? (y/n): "
      read confirm
      if [[ "$confirm" == "y" || "$confirm" == "Y" ]]; then
        bash "$DEPLOY_SCRIPT" undeploy
      else
        echo "Cancelled."
      fi
      ;;
    *)
      echo "Invalid choice"
      ;;
  esac
  
  echo ""
  echo "Press Enter to continue..."
  read
}

# Main loop
main() {
  while true; do
    show_main_menu
    read choice
    
    case "$choice" in
      1)
        capture_wizard
        ;;
      2)
        process_wizard
        ;;
      3)
        task_wizard
        ;;
      4)
        project_wizard
        ;;
      5)
        area_wizard
        ;;
      6)
        review_wizard
        ;;
      7)
        sync_wizard
        ;;
      8)
        moc_wizard
        ;;
      9)
        express_wizard
        ;;
      10)
        template_wizard
        ;;
      11)
        advice_wizard
        ;;
      12)
        clear
        gtd-learn
        echo ""
        echo "Press Enter to continue..."
        read
        ;;
      13)
        learn_second_brain_wizard
        ;;
      14)
        life_vision_wizard
        ;;
      15)
        log_wizard
        ;;
      16)
        search_wizard
        ;;
      17)
        status_wizard
        ;;
      18)
        habit_wizard
        ;;
      19)
        checkin_wizard
        ;;
      20)
        k8s_wizard
        ;;
      21)
        diagram_wizard
        ;;
      22)
        zettelkasten_wizard
        ;;
      23)
        ai_suggestions_wizard
        ;;
      0)
        clear
        echo ""
        echo "ğŸ‘‹ Goodbye! Keep getting things done!"
        echo ""
        exit 0
        ;;
      *)
        echo "Invalid choice. Press Enter..."
        read
        ;;
    esac
    
    clear
  done
}

# Run main function
main

